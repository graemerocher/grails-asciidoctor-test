<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>15.1 Unit Testing 3.2.0.RC2</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <div class="navTitle">
        
        The Grails Framework
    </div>
    <div class="navLinks">
        <ul>
            <li>
                <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                    <a href="../../guide/index.html" class="button">Table of contents</a>

                    <div id="nav-summary-childs" style="display:none;">
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/introduction.html"><strong>1</strong><span>Introduction</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/gettingStarted.html"><strong>2</strong><span>Getting Started</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/upgrading.html"><strong>3</strong><span>Upgrading from previous versions of Grails</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/conf.html"><strong>4</strong><span>Configuration</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/commandLine.html"><strong>5</strong><span>The Command Line</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/profiles.html"><strong>6</strong><span>Application Profiles</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/GORM.html"><strong>7</strong><span>Object Relational Mapping (GORM)</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/theWebLayer.html"><strong>8</strong><span>The Web Layer</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/traits.html"><strong>9</strong><span>Traits</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/webServices.html"><strong>10</strong><span>Web Services</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/async.html"><strong>11</strong><span>Asynchronous Programming</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/validation.html"><strong>12</strong><span>Validation</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/services.html"><strong>13</strong><span>The Service Layer</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/staticTypeCheckingAndCompilation.html"><strong>14</strong><span>Static Type Checking And Compilation</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/testing.html"><strong>15</strong><span>Testing</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/i18n.html"><strong>16</strong><span>Internationalization</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/security.html"><strong>17</strong><span>Security</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/plugins.html"><strong>18</strong><span>Plugins</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/spring.html"><strong>19</strong><span>Grails and Spring</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/hibernate.html"><strong>20</strong><span>Grails and Hibernate</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/scaffolding.html"><strong>21</strong><span>Scaffolding</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/deployment.html"><strong>22</strong><span>Deployment</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/contributing.html"><strong>23</strong><span>Contributing to Grails</span></a>
                        </div>
                        
                    </div>
                </div>
            </li>
            <li class="separator selected">
                <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
            </li>
        </ul>
    </div>


</div>

<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../../guide/staticTypeCheckingAndCompilation.html">&lt;&lt; <strong>14</strong><span>Static Type Checking And Compilation</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../../guide/i18n.html"><strong>16</strong><span>Internationalization</span> >></a></div>
                


                <div class="project">
                    <h1>15.1 Unit Testing</h1>

                    <p><strong>Version:</strong> 3.2.0.RC2</p>
                </div>

                
                <div id="table-of-content">
                    <h2>Table of Contents</h2>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#unitTestingControllers"><strong>15.1</strong><span>Unit Testing Controllers</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#unitTestingTagLibraries"><strong>15.2</strong><span>Unit Testing Tag Libraries</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#unitTestingDomains"><strong>15.3</strong><span>Unit Testing Domains</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#unitTestingFilters"><strong>15.4</strong><span>Unit Testing Filters</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#unitTestingURLMappings"><strong>15.5</strong><span>Unit Testing URL Mappings</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#mockingCollaborators"><strong>15.6</strong><span>Mocking Collaborators</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#mockingCodecs"><strong>15.7</strong><span>Mocking Codecs</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#unitTestMetaprogramming"><strong>15.8</strong><span>Unit Test Metaprogramming</span></a>
                    </div>
                    
                </div>
                

                
<a name="12.1 Unit Testing"><!-- Legacy link --></a>
<h2 id="unitTesting">15.1 Unit Testing</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/tree/master/src/en/guide/testing/unitTesting.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Unit testing are tests at the "unit" level. In other words you are testing individual methods or blocks of code without consideration for surrounding infrastructure. Unit tests are typically run without the presence of physical resources that involve I/O such databases, socket connections or files. This is to ensure they run as quick as possible since quick feedback is important.</p>
</div>
<div class="sect3">
<h4 id="_the_test_mixins">The Test Mixins</h4>
<div class="paragraph">
<p>Since Grails 2.0, a collection of unit testing mixins is provided by Grails that lets you enhance the behavior of a typical JUnit 3, JUnit 4 or Spock test. The following sections cover the usage of these mixins.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The previous JUnit 3-style <code>GrailsUnitTestCase</code> class hierarchy is still present in Grails for backwards compatibility, but is now deprecated. The previous documentation on the subject can be found in the <a href="http://grails.org/doc/1.3.x/guide/9.%20Testing.html">Grails 1.3.x documentation</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You won&#8217;t normally have to import any of the testing classes because Grails does that for you. But if you find that your IDE for example can&#8217;t find the classes, here they all are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>grails.test.mixin.TestFor</code></p>
</li>
<li>
<p><code>grails.test.mixin.Mock</code></p>
</li>
<li>
<p><code>grails.test.mixin.TestMixin</code></p>
</li>
<li>
<p><code>grails.test.mixin.support.GrailsUnitTestMixin</code></p>
</li>
<li>
<p><code>grails.test.mixin.domain.DomainClassUnitTestMixin</code></p>
</li>
<li>
<p><code>grails.test.mixin.services.ServiceUnitTestMixin</code></p>
</li>
<li>
<p><code>grails.test.mixin.web.ControllerUnitTestMixin</code></p>
</li>
<li>
<p><code>grails.test.mixin.web.InterceptorUnitTestMixin</code></p>
</li>
<li>
<p><code>grails.test.mixin.web.GroovyPageUnitTestMixin</code></p>
</li>
<li>
<p><code>grails.test.mixin.web.UrlMappingsUnitTestMixin</code></p>
</li>
<li>
<p><code>grails.test.mixin.hibernate.HibernateTestMixin</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that you&#8217;re only ever likely to use the first two explicitly. The rest are there for reference.</p>
</div>
</div>
<div class="sect3">
<h4 id="_test_mixin_basics">Test Mixin Basics</h4>
<div class="paragraph">
<p>Most testing can be achieved via the <code>TestFor</code> annotation in combination with the <code>Mock</code> annotation for mocking collaborators. For example, to test a controller and associated domains you would define the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="error">\</span><span class="annotation">@TestFor</span>(BookController)
<span class="error">\</span><span class="annotation">@Mock</span>([<span class="predefined-type">Book</span>, Author, BookService])</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>TestFor</code> annotation defines the class under test and will automatically create a field for the type of class under test. For example in the above case a "controller" field will be present, however if <code>TestFor</code> was defined for a service a "service" field would be created and so on.</p>
</div>
<div class="paragraph">
<p>The <code>Mock</code> annotation creates mock version of any collaborators. There is an in-memory implementation of GORM that will simulate most interactions with the GORM API.</p>
</div>
</div>
<div class="sect3">
<h4 id="_dowithspring_and_dowithconfig_callback_methods_freshruntime_annotation">doWithSpring and doWithConfig callback methods, FreshRuntime annotation</h4>
<div class="paragraph">
<p>The <code>doWithSpring</code> callback method can be used to add beans with the BeanBuilder DSL. There is the <code>doWithConfig</code> callback method for changing the grailsApplication.config values before the grailsApplication instance of the test runtime gets initialized.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.test.mixin.support.GrailsUnitTestMixin</span>

<span class="keyword">import</span> <span class="include">org.junit.ClassRule</span>
<span class="keyword">import</span> <span class="include">org.junit.rules.TestRule</span>

<span class="keyword">import</span> <span class="include">spock.lang.Ignore</span>;
<span class="keyword">import</span> <span class="include">spock.lang.IgnoreRest</span>
<span class="keyword">import</span> <span class="include">spock.lang.Shared</span>;
<span class="keyword">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@TestMixin</span>(GrailsUnitTestMixin)
<span class="type">class</span> <span class="class">StaticCallbacksSpec</span> <span class="directive">extends</span> Specification {
    <span class="directive">static</span> doWithSpring = {
        myService(MyService)
    }

    <span class="directive">static</span> doWithConfig(c) {
        c.myConfigValue = <span class="string"><span class="delimiter">'</span><span class="content">Hello</span><span class="delimiter">'</span></span>
    }

    <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">grailsApplication is not null</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">expect</span>:
        grailsApplication != <span class="predefined-constant">null</span>
    }

    <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">doWithSpring callback is executed</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">expect</span>:
        grailsApplication.mainContext.getBean(<span class="string"><span class="delimiter">'</span><span class="content">myService</span><span class="delimiter">'</span></span>) != <span class="predefined-constant">null</span>
    }

    <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">doWithConfig callback is executed</span><span class="delimiter">&quot;</span></span>(){
        <span class="key">expect</span>:
        config.myConfigValue == <span class="string"><span class="delimiter">'</span><span class="content">Hello</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use these callbacks without "static" together with the <code><a href="http://docs.grails.org/latest/api/grails/test/runtime/FreshRuntime.html">grails.test.runtime.FreshRuntime</a></code> annotation.
In this case, a clean application context and grails application instance is initialized for each test method call.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.test.mixin.support.GrailsUnitTestMixin</span>
<span class="keyword">import</span> <span class="include">grails.test.runtime.FreshRuntime</span>;

<span class="keyword">import</span> <span class="include">org.junit.ClassRule</span>
<span class="keyword">import</span> <span class="include">org.junit.rules.TestRule</span>

<span class="keyword">import</span> <span class="include">spock.lang.Ignore</span>;
<span class="keyword">import</span> <span class="include">spock.lang.IgnoreRest</span>
<span class="keyword">import</span> <span class="include">spock.lang.Shared</span>;
<span class="keyword">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@FreshRuntime</span>
<span class="annotation">@TestMixin</span>(GrailsUnitTestMixin)
<span class="type">class</span> <span class="class">TestInstanceCallbacksSpec</span> <span class="directive">extends</span> Specification {
    <span class="keyword">def</span> doWithSpring = {
        myService(MyService)
    }

    <span class="keyword">def</span> <span class="function">doWithConfig</span>(c) {
        c.myConfigValue = <span class="string"><span class="delimiter">'</span><span class="content">Hello</span><span class="delimiter">'</span></span>
    }

    <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">grailsApplication is not null</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">expect</span>:
        grailsApplication != <span class="predefined-constant">null</span>
    }

    <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">doWithSpring callback is executed</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">expect</span>:
        grailsApplication.mainContext.getBean(<span class="string"><span class="delimiter">'</span><span class="content">myService</span><span class="delimiter">'</span></span>) != <span class="predefined-constant">null</span>
    }

    <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">doWithConfig callback is executed</span><span class="delimiter">&quot;</span></span>(){
        <span class="key">expect</span>:
        config.myConfigValue == <span class="string"><span class="delimiter">'</span><span class="content">Hello</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use <code><a href="http://docs.grails.org/latest/api/org/grails/spring/beans/factory/InstanceFactoryBean.html">org.grails.spring.beans.factory.InstanceFactoryBean</a></code> together with doWithSpring and the <a href="http://docs.grails.org/latest/api/grails/test/runtime/FreshRuntime.html">FreshRuntime</a> annotation to mock beans in tests.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.test.mixin.support.GrailsUnitTestMixin</span>
<span class="keyword">import</span> <span class="include">grails.test.runtime.FreshRuntime</span>

<span class="keyword">import</span> <span class="include">org.grails.spring.beans.factory.InstanceFactoryBean</span>
<span class="keyword">import</span> <span class="include">org.junit.ClassRule</span>

<span class="keyword">import</span> <span class="include">spock.lang.Shared</span>
<span class="keyword">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@FreshRuntime</span>
<span class="annotation">@TestMixin</span>(GrailsUnitTestMixin)
<span class="type">class</span> <span class="class">MockedBeanSpec</span> <span class="directive">extends</span> Specification {
    <span class="keyword">def</span> myService=Mock(MyService)

    <span class="keyword">def</span> doWithSpring = {
        myService(InstanceFactoryBean, myService, MyService)
    }

    <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">doWithSpring callback is executed</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">when</span>:
        <span class="keyword">def</span> myServiceBean=grailsApplication.mainContext.getBean(<span class="string"><span class="delimiter">'</span><span class="content">myService</span><span class="delimiter">'</span></span>)
        myServiceBean.prova()
        <span class="key">then</span>:
        <span class="integer">1</span> * myService.prova() &gt;&gt; { <span class="predefined-constant">true</span> }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_the_dirtiesruntime_annotation">The DirtiesRuntime annotation</h4>
<div class="paragraph">
<p>Test methods may be marked with the <code><a href="http://docs.grails.org/latest/api/grails/test/runtime/DirtiesRuntime.html">grails.test.runtime.DirtiesRuntime</a></code> annotation to indicate that the test modifies the runtime in ways which might be problematic for other tests and as such the runtime should be refreshed after this test method runs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.test.mixin.TestFor</span>
<span class="keyword">import</span> <span class="include">spock.lang.Specification</span>
<span class="keyword">import</span> <span class="include">grails.test.runtime.DirtiesRuntime</span>

<span class="annotation">@TestFor</span>(PersonController)
<span class="type">class</span> <span class="class">PersonControllerSpec</span> <span class="directive">extends</span> Specification {

    <span class="annotation">@DirtiesRuntime</span>
    <span class="type">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">a test method which modifies the runtime</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">when</span>:
        Person.metaClass.someMethod = { ... }
        <span class="comment">// ...</span>

        <span class="key">then</span>:
        <span class="comment">// ...</span>
    }

    <span class="type">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">a test method which should not be affected by the previous test method</span><span class="delimiter">&quot;</span></span>() {
        <span class="comment">// ...</span>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_sharing_test_runtime_grailsapplication_instance_and_beans_for_several_test_classes">Sharing test runtime grailsApplication instance and beans for several test classes</h4>
<div class="paragraph">
<p>It&#8217;s possible to share a single grailsApplication instance and beans for several test classes.
This feature is activated by the <code><a href="http://docs.grails.org/latest/api/grails/test/runtime/SharedRuntime.html">SharedRuntime</a></code> annotation. This annotation takes an optional class parameter
implements <code><a href="http://docs.grails.org/latest/api/grails/test/runtime/SharedRuntimeConfigurer.html">SharedRuntimeConfigurer</a></code> interface. All test classes referencing the same SharedRuntimeConfigurer implementation
class will share the same runtime during a single test run.
The value class for SharedRuntimeConfigurer annotation can also implement <code><a href="http://docs.grails.org/latest/api/grails/test/runtime/TestEventInterceptor.html">TestEventInterceptor</a></code> . In this case the instance of the class
will be registered as a test event interceptor for the test runtime.</p>
</div>
</div>
<div class="sect3">
<h4 id="_loading_application_beans_in_unit_tests">Loading application beans in unit tests</h4>
<div class="paragraph">
<p>Adding <code>static loadExternalBeans = true</code> field definition to a unit test class makes the Grails unit test runtime load all bean definitions from <code>grails-app/conf/spring/resources.groovy</code> and <code>grails-app/conf/spring/resources.xml</code> files.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">spock.lang.Issue</span>
<span class="keyword">import</span> <span class="include">spock.lang.Specification</span>
<span class="keyword">import</span> <span class="include">grails.test.mixin.support.GrailsUnitTestMixin</span>

<span class="annotation">@TestMixin</span>(GrailsUnitTestMixin)
<span class="type">class</span> <span class="class">LoadExternalBeansSpec</span> <span class="directive">extends</span> Specification {
    <span class="directive">static</span> loadExternalBeans = <span class="predefined-constant">true</span>

    <span class="type">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">should load external beans</span><span class="delimiter">&quot;</span></span>(){
        <span class="key">expect</span>:
        applicationContext.getBean(<span class="string"><span class="delimiter">'</span><span class="content">simpleBean</span><span class="delimiter">'</span></span>) == <span class="string"><span class="delimiter">'</span><span class="content">Hello world!</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>

<a name="12.1.1 Unit Testing Controllers"><!-- Legacy link --></a>
<h2 id="unitTestingControllers">15.1.1 Unit Testing Controllers</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/tree/master/src/en/guide/testing/unitTesting/unitTestingControllers.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_the_basics">The Basics</h4>
<div class="paragraph">
<p>You use the <code>grails.test.mixin.TestFor</code> annotation to unit test controllers. Using <code>TestFor</code> in this manner activates the <code>grails.test.mixin.web.ControllerUnitTestMixin</code> and its associated API. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">grails.test.mixin.TestFor</span>
<span class="include">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@TestFor</span>(<span class="include">SimpleController</span>)
<span class="include">class</span> <span class="include">SimpleControllerSpec</span> <span class="include">extends</span> <span class="include">Specification</span> {

    <span class="include">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test something</span><span class="delimiter">&quot;</span></span>() {
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Adding the <code>TestFor</code> annotation to a controller causes a new <code>controller</code> field to be automatically created for the controller under test.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The <code>TestFor</code> annotation will also automatically annotate any public methods starting with "test" with JUnit 4&#8217;s @Test annotation. If any of your test method don&#8217;t start with "test" just add this manually
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To test the simplest "Hello World"-style example you can do the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Test class</span>
<span class="type">class</span> <span class="class">SimpleController</span> {
    def hello() {
        render <span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">grails.test.mixin.TestFor</span>
<span class="include">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@TestFor</span>(<span class="include">SimpleController</span>)
<span class="include">class</span> <span class="include">SimpleControllerSpec</span> <span class="include">extends</span> <span class="include">Specification</span> {

    <span class="include">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test hello</span><span class="delimiter">&quot;</span></span>() {
        <span class="include">when</span>:
        <span class="include">controller.hello</span>()

        <span class="include">then</span>:
        <span class="include">response.text</span> == <span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>response</code> object is an instance of <code>GrailsMockHttpServletResponse</code> (from the package <code>org.codehaus.groovy.grails.plugins.testing</code>) which extends Spring&#8217;s <code>MockHttpServletResponse</code> class and has a number of useful methods for inspecting the state of the response.</p>
</div>
<div class="paragraph">
<p>For example to test a redirect you can use the <code>redirectedUrl</code> property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">class</span> <span class="class">SimpleController</span> {
    def index() {
        redirect action: <span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span>
    }
    ...
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">grails.test.mixin.TestFor</span>
<span class="include">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@TestFor</span>(<span class="include">SimpleController</span>)
<span class="include">class</span> <span class="include">SimpleControllerSpec</span> <span class="include">extends</span> <span class="include">Specification</span> {

    <span class="include">void</span> <span class="string"><span class="delimiter">'</span><span class="content">test index</span><span class="delimiter">'</span></span>() {
        <span class="include">when</span>:
        <span class="include">controller.index</span>()

        <span class="include">then</span>:
        <span class="include">response.redirectedUrl</span> == <span class="string"><span class="delimiter">'</span><span class="content">/simple/hello</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Many actions make use of the parameter data associated with the request. For example, the 'sort', 'max', and 'offset' parameters are quite common. Providing these in the test is as simple as adding appropriate values to a special <code>params</code> variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">grails.test.mixin.TestFor</span>
<span class="include">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@TestFor</span>(<span class="include">PersonController</span>)
<span class="include">class</span> <span class="include">PersonControllerSpec</span> <span class="include">extends</span> <span class="include">Specification</span> {

    <span class="include">void</span> <span class="string"><span class="delimiter">'</span><span class="content">test list</span><span class="delimiter">'</span></span>() {
        <span class="include">when</span>:
        <span class="include">params.sort</span> = <span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>
        <span class="include">params.max</span> = <span class="integer">20</span>
        <span class="include">params.offset</span> = <span class="integer">0</span>
        <span class="include">controller.list</span>()

        <span class="include">then</span>:
        <span class="comment">// ...</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can even control what type of request the controller action sees by setting the <code>method</code> property of the mock request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">grails.test.mixin.TestFor</span>
<span class="include">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@TestFor</span>(<span class="include">PersonController</span>)
<span class="include">class</span> <span class="include">PersonControllerSpec</span> <span class="include">extends</span> <span class="include">Specification</span> {

    <span class="include">void</span> <span class="string"><span class="delimiter">'</span><span class="content">test save</span><span class="delimiter">'</span></span>() {
        <span class="include">when</span>:
        <span class="include">request.method</span> = <span class="string"><span class="delimiter">'</span><span class="content">POST</span><span class="delimiter">'</span></span>
        <span class="include">controller.save</span>()

        <span class="include">then</span>:
        <span class="comment">// ...</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is particularly important if your actions do different things depending on the type of the request. Finally, you can mark a request as AJAX like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">grails.test.mixin.TestFor</span>
<span class="include">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@TestFor</span>(<span class="include">PersonController</span>)
<span class="include">class</span> <span class="include">PersonControllerSpec</span> <span class="include">extends</span> <span class="include">Specification</span> {

    <span class="include">void</span> <span class="string"><span class="delimiter">'</span><span class="content">test list</span><span class="delimiter">'</span></span>() {
        <span class="include">when</span>:
        <span class="include">request.method</span> = <span class="string"><span class="delimiter">'</span><span class="content">POST</span><span class="delimiter">'</span></span>
        <span class="include">request.makeAjaxRequest</span>()
        <span class="include">controller.getPage</span>()

        <span class="include">then</span>:
        <span class="comment">// ...</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You only need to do this though if the code under test uses the <code>xhr</code> property on the request.</p>
</div>
</div>
<div class="sect3">
<h4 id="_testing_view_rendering">Testing View Rendering</h4>
<div class="paragraph">
<p>To test view rendering you can inspect the state of the controller&#8217;s <code>modelAndView</code> property (an instance of <code>org.springframework.web.servlet.ModelAndView</code>) or you can use the <code>view</code> and <code>model</code> properties provided by the mixin:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">class</span> <span class="class">SimpleController</span> {
    def home() {
        render view: <span class="string"><span class="delimiter">&quot;</span><span class="content">homePage</span><span class="delimiter">&quot;</span></span>, model: [title: <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>]
    }
    ...
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">grails.test.mixin.TestFor</span>
<span class="include">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@TestFor</span>(<span class="include">SimpleController</span>)
<span class="include">class</span> <span class="include">SimpleControllerSpec</span> <span class="include">extends</span> <span class="include">Specification</span> {

    <span class="include">void</span> <span class="string"><span class="delimiter">'</span><span class="content">test home</span><span class="delimiter">'</span></span>() {
        <span class="include">when</span>:
        <span class="include">controller.home</span>()

        <span class="include">then</span>:
        <span class="include">view</span> == <span class="string"><span class="delimiter">'</span><span class="content">/simple/homePage</span><span class="delimiter">'</span></span>
        <span class="include">model.title</span> == <span class="string"><span class="delimiter">'</span><span class="content">Hello World</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the view string is the absolute view path, so it starts with a '/' and will include path elements, such as the directory named after the action&#8217;s controller.</p>
</div>
</div>
<div class="sect3">
<h4 id="_testing_template_rendering">Testing Template Rendering</h4>
<div class="paragraph">
<p>Unlike view rendering, template rendering will actually attempt to write the template directly to the response rather than returning a <code>ModelAndView</code> hence it requires a different approach to testing.</p>
</div>
<div class="paragraph">
<p>Consider the following controller action:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">class</span> <span class="class">SimpleController</span> {
    def display() {
        render template:<span class="string"><span class="delimiter">&quot;</span><span class="content">snippet</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example the controller will look for a template in <code>grails-app/views/simple/_snippet.gsp</code>. You can test this as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">grails.test.mixin.TestFor</span>
<span class="include">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@TestFor</span>(<span class="include">SimpleController</span>)
<span class="include">class</span> <span class="include">SimpleControllerSpec</span> <span class="include">extends</span> <span class="include">Specification</span> {

    <span class="include">void</span> <span class="string"><span class="delimiter">'</span><span class="content">test display</span><span class="delimiter">'</span></span>() {
        <span class="include">when</span>:
        <span class="include">controller.display</span>()

        <span class="include">then</span>:
        <span class="include">response.text</span> == <span class="string"><span class="delimiter">'</span><span class="content">contents of the template</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, you may not want to render the real template, but just test that is was rendered. In this case you can provide mock Groovy Pages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">grails.test.mixin.TestFor</span>
<span class="include">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@TestFor</span>(<span class="include">SimpleController</span>)
<span class="include">class</span> <span class="include">SimpleControllerSpec</span> <span class="include">extends</span> <span class="include">Specification</span> {

    <span class="include">void</span> <span class="string"><span class="delimiter">'</span><span class="content">test display with mock template</span><span class="delimiter">'</span></span>() {
        <span class="include">when</span>:
        <span class="include">views</span>[<span class="string"><span class="delimiter">'</span><span class="content">/simple/_snippet.gsp</span><span class="delimiter">'</span></span>] = <span class="string"><span class="delimiter">'</span><span class="content">mock template contents</span><span class="delimiter">'</span></span>
        <span class="include">controller.display</span>()

        <span class="include">then</span>:
        <span class="include">response.text</span> == <span class="string"><span class="delimiter">'</span><span class="content">mock template contents</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_testing_actions_which_return_a_map">Testing Actions Which Return A Map</h4>
<div class="paragraph">
<p>When a controller action returns a <code>java.util.Map</code> that <code>Map</code> may be inspected directly to assert that it contains the expected data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">class</span> <span class="class">SimpleController</span> {
    def showBookDetails() {
        [title: <span class="string"><span class="delimiter">'</span><span class="content">The Nature Of Necessity</span><span class="delimiter">'</span></span>, author: <span class="string"><span class="delimiter">'</span><span class="content">Alvin Plantinga</span><span class="delimiter">'</span></span>]
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">grails.test.mixin.TestFor</span>
<span class="include">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@TestFor</span>(<span class="include">SimpleController</span>)
<span class="include">class</span> <span class="include">SimpleControllerSpec</span> <span class="include">extends</span> <span class="include">Specification</span> {

    <span class="include">void</span> <span class="string"><span class="delimiter">'</span><span class="content">test show book details</span><span class="delimiter">'</span></span>() {
        <span class="include">when</span>:
        <span class="include">def</span> <span class="include">model</span> = <span class="include">controller.showBookDetails</span>()

        <span class="include">then</span>:
        <span class="include">model.author</span> == <span class="string"><span class="delimiter">'</span><span class="content">Alvin Plantinga</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_testing_xml_and_json_responses">Testing XML and JSON Responses</h4>
<div class="paragraph">
<p>XML and JSON response are also written directly to the response. Grails' mocking capabilities provide some conveniences for testing XML and JSON response. For example consider the following action:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">def renderXml() {
    render(contentType:<span class="string"><span class="delimiter">&quot;</span><span class="content">text/xml</span><span class="delimiter">&quot;</span></span>) {
        book(title:<span class="string"><span class="delimiter">&quot;</span><span class="content">Great</span><span class="delimiter">&quot;</span></span>)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This can be tested using the <code>xml</code> property of the response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">grails.test.mixin.TestFor</span>
<span class="include">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@TestFor</span>(<span class="include">SimpleController</span>)
<span class="include">class</span> <span class="include">SimpleControllerSpec</span> <span class="include">extends</span> <span class="include">Specification</span> {

    <span class="include">void</span> <span class="string"><span class="delimiter">'</span><span class="content">test render xml</span><span class="delimiter">'</span></span>() {
        <span class="include">when</span>:
        <span class="include">controller.renderXml</span>()

        <span class="include">then</span>:
        <span class="include">response.text</span> == <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;book title='Great'/&gt;</span><span class="delimiter">&quot;</span></span>
        <span class="include">response.xml</span>.<span class="annotation">@title</span>.<span class="include">text</span>() == <span class="string"><span class="delimiter">'</span><span class="content">Great</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>xml</code> property is a parsed result from Groovy&#8217;s <a href="http://groovy.codehaus.org/Reading+XML+using+Groovy&#8217;s+XmlSlurper">XmlSlurper</a> class which is very convenient for parsing XML.</p>
</div>
<div class="paragraph">
<p>Testing JSON responses is pretty similar, instead you use the <code>json</code> property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// controller action</span>
def renderJson() {
    render(contentType:<span class="string"><span class="delimiter">&quot;</span><span class="content">application/json</span><span class="delimiter">&quot;</span></span>) {
        book = <span class="string"><span class="delimiter">&quot;</span><span class="content">Great</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">grails.test.mixin.TestFor</span>
<span class="include">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@TestFor</span>(<span class="include">SimpleController</span>)
<span class="include">class</span> <span class="include">SimpleControllerSpec</span> <span class="include">extends</span> <span class="include">Specification</span> {

    <span class="include">void</span> <span class="string"><span class="delimiter">'</span><span class="content">test render json</span><span class="delimiter">'</span></span>() {
        <span class="include">when</span>:
        <span class="include">controller.renderJson</span>()

        <span class="include">then</span>:
        <span class="include">response.text</span> == <span class="string"><span class="delimiter">'</span><span class="content">{&quot;Great&quot;}</span><span class="delimiter">'</span></span>[<span class="include">book</span>]         <span class="include">response.json.book</span> == <span class="string"><span class="delimiter">'</span><span class="content">Great</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>json</code> property is an instance of <code>org.codehaus.groovy.grails.web.json.JSONElement</code> which is a map-like structure that is useful for parsing JSON responses.</p>
</div>
</div>
<div class="sect3">
<h4 id="_testing_xml_and_json_requests">Testing XML and JSON Requests</h4>
<div class="paragraph">
<p>Grails provides various convenient ways to automatically parse incoming XML and JSON packets. For example you can bind incoming JSON or XML requests using Grails' data binding:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">consumeBook</span>(<span class="predefined-type">Book</span> b) {
    render <span class="string"><span class="delimiter">&quot;</span><span class="content">The title is </span><span class="inline"><span class="inline-delimiter">${</span>b.title<span class="inline-delimiter">}</span></span><span class="content">.</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To test this Grails provides an easy way to specify an XML or JSON packet via the <code>xml</code> or <code>json</code> properties. For example the above action can be tested by specifying a String containing the XML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.test.mixin.TestFor</span>
<span class="keyword">import</span> <span class="include">grails.test.mixin.Mock</span>
<span class="keyword">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@TestFor</span>(SimpleController)
<span class="annotation">@Mock</span>(&lt;&lt;<span class="predefined-type">Book</span>&gt;&gt;)
<span class="type">class</span> <span class="class">SimpleControllerSpec</span> <span class="directive">extends</span> Specification {
    <span class="type">void</span> <span class="string"><span class="delimiter">'</span><span class="content">test consume book xml</span><span class="delimiter">'</span></span>() {
        <span class="key">when</span>:
        request.xml = <span class="string"><span class="delimiter">'</span><span class="content">&lt;book&gt;&lt;title&gt;Wool&lt;/title&gt;&lt;/book&gt;</span><span class="delimiter">'</span></span>
        controller.consumeBook()

        <span class="key">then</span>:
        response.text == <span class="string"><span class="delimiter">'</span><span class="content">The title is Wool.</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or alternatively a domain instance can be specified and it will be auto-converted into the appropriate XML request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.test.mixin.TestFor</span>
<span class="keyword">import</span> <span class="include">grails.test.mixin.Mock</span>
<span class="keyword">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@TestFor</span>(SimpleController)
<span class="annotation">@Mock</span>(&lt;&lt;<span class="predefined-type">Book</span>&gt;&gt;)
<span class="type">class</span> <span class="class">SimpleControllerSpec</span> <span class="directive">extends</span> Specification {

    <span class="type">void</span> <span class="string"><span class="delimiter">'</span><span class="content">test consume book xml</span><span class="delimiter">'</span></span>() {
        <span class="key">when</span>:
        request.xml = <span class="keyword">new</span> <span class="predefined-type">Book</span>(<span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">Shift</span><span class="delimiter">'</span></span>)
        controller.consumeBook()

        <span class="key">then</span>:
        response.text == <span class="string"><span class="delimiter">'</span><span class="content">The title is Shift.</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The same can be done for JSON requests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.test.mixin.TestFor</span>
<span class="keyword">import</span> <span class="include">grails.test.mixin.Mock</span>
<span class="keyword">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@TestFor</span>(SimpleController)
<span class="annotation">@Mock</span>(&lt;&lt;<span class="predefined-type">Book</span>&gt;&gt;)
<span class="type">class</span> <span class="class">SimpleControllerSpec</span> <span class="directive">extends</span> Specification {

    <span class="type">void</span> <span class="string"><span class="delimiter">'</span><span class="content">test consume book json</span><span class="delimiter">'</span></span>() {
        <span class="key">when</span>:
        request.json = <span class="keyword">new</span> <span class="predefined-type">Book</span>(<span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">Shift</span><span class="delimiter">'</span></span>)
        controller.consumeBook()

        <span class="key">then</span>:
        response.text == <span class="string"><span class="delimiter">'</span><span class="content">The title is Shift.</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you prefer not to use Grails' data binding but instead manually parse the incoming XML or JSON that can be tested too. For example consider the controller action below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">consume</span>() {
    request.withFormat {
        xml {
            render <span class="string"><span class="delimiter">&quot;</span><span class="content">The XML Title Is </span><span class="inline"><span class="inline-delimiter">${</span>request.XML.@title<span class="inline-delimiter">}</span></span><span class="content">.</span><span class="delimiter">&quot;</span></span>
        }
        json {
            render <span class="string"><span class="delimiter">&quot;</span><span class="content">The JSON Title Is </span><span class="inline"><span class="inline-delimiter">${</span>request.JSON.title<span class="inline-delimiter">}</span></span><span class="content">.</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To test the XML request you can specify the XML as a string:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.test.mixin.TestFor</span>
<span class="keyword">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@TestFor</span>(SimpleController)
<span class="type">class</span> <span class="class">SimpleControllerSpec</span> <span class="directive">extends</span> Specification {

    <span class="type">void</span> <span class="string"><span class="delimiter">'</span><span class="content">test consume xml</span><span class="delimiter">'</span></span>() {
        <span class="key">when</span>:
        request.xml = <span class="string"><span class="delimiter">'</span><span class="content">&lt;book title=&quot;The Stand&quot;/&gt;</span><span class="delimiter">'</span></span>
        controller.consume()

        <span class="key">then</span>:
        response.text == <span class="string"><span class="delimiter">'</span><span class="content">The XML Title Is The Stand.</span><span class="delimiter">'</span></span>
    }

    <span class="type">void</span> <span class="string"><span class="delimiter">'</span><span class="content">test consume json</span><span class="delimiter">'</span></span>() {
        <span class="key">when</span>:
        request.json = <span class="string"><span class="delimiter">'</span><span class="content">{title:&quot;The Stand&quot;}</span><span class="delimiter">'</span></span>
        controller.consume()

        <span class="key">then</span>:
        response.text == <span class="string"><span class="delimiter">'</span><span class="content">The JSON Title Is The Stand.</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_testing_mime_type_handling">Testing Mime Type Handling</h4>
<div class="paragraph">
<p>You can test mime type handling and the <code>withFormat</code> method quite simply by setting the request&#8217;s <code>contentType</code> attribute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// controller action</span>
def sayHello() {
    def data = [Hello:<span class="string"><span class="delimiter">&quot;</span><span class="content">World</span><span class="delimiter">&quot;</span></span>]
    request.withFormat {
        xml { render data as grails.converters.XML }
        json { render data as grails.converters.JSON }
        html data
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">grails.test.mixin.TestFor</span>
<span class="include">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@TestFor</span>(<span class="include">SimpleController</span>)
<span class="include">class</span> <span class="include">SimpleControllerSpec</span> <span class="include">extends</span> <span class="include">Specification</span> {

    <span class="include">void</span> <span class="string"><span class="delimiter">'</span><span class="content">test say hello xml</span><span class="delimiter">'</span></span>() {
        <span class="include">when</span>:
        <span class="include">request.contentType</span> = <span class="string"><span class="delimiter">'</span><span class="content">application/xml</span><span class="delimiter">'</span></span>
        <span class="include">controller.sayHello</span>()

        <span class="include">then</span>:
        <span class="include">response.text</span> == <span class="string"><span class="delimiter">'</span><span class="content">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;map&gt;&lt;entry key=&quot;Hello&quot;&gt;World&lt;/entry&gt;&lt;/map&gt;</span><span class="delimiter">'</span></span>
    }

    <span class="include">void</span> <span class="string"><span class="delimiter">'</span><span class="content">test say hello json</span><span class="delimiter">'</span></span>() {
        <span class="include">when</span>:
        <span class="include">request.contentType</span> = <span class="string"><span class="delimiter">'</span><span class="content">application/json</span><span class="delimiter">'</span></span>
        <span class="include">controller.sayHello</span>()

        <span class="include">then</span>:
        <span class="include">response.text</span> == <span class="string"><span class="delimiter">'</span><span class="content">{&quot;World&quot;}</span><span class="delimiter">'</span></span>[<span class="include">Hello</span>]     }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are constants provided by <code>ControllerUnitTestMixin</code> for all of the common common content types as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">grails.test.mixin.TestFor</span>
<span class="include">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@TestFor</span>(<span class="include">SimpleController</span>)
<span class="include">class</span> <span class="include">SimpleControllerSpec</span> <span class="include">extends</span> <span class="include">Specification</span> {

    <span class="include">void</span> <span class="string"><span class="delimiter">'</span><span class="content">test say hello xml</span><span class="delimiter">'</span></span>() {
        <span class="include">when</span>:
        <span class="include">request.contentType</span> = <span class="include">XML_CONTENT_TYPE</span>
        <span class="include">controller.sayHello</span>()

        <span class="include">then</span>:
        <span class="include">response.text</span> == <span class="string"><span class="delimiter">'</span><span class="content">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;map&gt;&lt;entry key=&quot;Hello&quot;&gt;World&lt;/entry&gt;&lt;/map&gt;</span><span class="delimiter">'</span></span>
    }

    <span class="include">void</span> <span class="string"><span class="delimiter">'</span><span class="content">test say hello json</span><span class="delimiter">'</span></span>() {
        <span class="include">when</span>:
        <span class="include">request.contentType</span> = <span class="include">JSON_CONTENT_TYPE</span>
        <span class="include">controller.sayHello</span>()

        <span class="include">then</span>:
        <span class="include">response.text</span> == <span class="string"><span class="delimiter">'</span><span class="content">{&quot;World&quot;}</span><span class="delimiter">'</span></span>[<span class="include">Hello</span>]     }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The defined constants are listed below:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Constant</strong></th>
<th class="tableblock halign-left valign-top"><strong>Value</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL_CONTENT_TYPE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*/\*</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FORM_CONTENT_TYPE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/x-www-form-urlencoded</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MULTIPART_FORM_CONTENT_TYPE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">multipart/form-data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTML_CONTENT_TYPE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text/html</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">XHTML_CONTENT_TYPE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/xhtml+xml</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">XML_CONTENT_TYPE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/xml</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON_CONTENT_TYPE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/json</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TEXT_XML_CONTENT_TYPE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text/xml</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TEXT_JSON_CONTENT_TYPE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text/json</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HAL_JSON_CONTENT_TYPE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/hal+json</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HAL_XML_CONTENT_TYPE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/hal+xml</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ATOM_XML_CONTENT_TYPE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/atom+xml</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_testing_duplicate_form_submissions">Testing Duplicate Form Submissions</h4>
<div class="paragraph">
<p>Testing duplicate form submissions is a little bit more involved. For example if you have an action that handles a form such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">def handleForm() {
    withForm {
        render <span class="string"><span class="delimiter">&quot;</span><span class="content">Good</span><span class="delimiter">&quot;</span></span>
    }.invalidToken {
        render <span class="string"><span class="delimiter">&quot;</span><span class="content">Bad</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>you want to verify the logic that is executed on a good form submission and the logic that is executed on a duplicate submission. Testing the bad submission is simple. Just invoke the controller:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">grails.test.mixin.TestFor</span>
<span class="include">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@TestFor</span>(<span class="include">SimpleController</span>)
<span class="include">class</span> <span class="include">SimpleControllerSpec</span> <span class="include">extends</span> <span class="include">Specification</span> {

    <span class="include">void</span> <span class="string"><span class="delimiter">'</span><span class="content">test duplicate form submission</span><span class="delimiter">'</span></span>() {
        <span class="include">when</span>:
        <span class="include">controller.handleForm</span>()

        <span class="include">then</span>:
        <span class="include">response.text</span> == <span class="string"><span class="delimiter">'</span><span class="content">Bad</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Testing the successful submission requires providing an appropriate <code>SynchronizerToken</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">grails.test.mixin.TestFor</span>
<span class="include">import</span> <span class="include">spock.lang.Specification</span>

<span class="include">import</span> <span class="include">org.codehaus.groovy.grails.web.servlet.mvc.SynchronizerTokensHolder</span>

<span class="annotation">@TestFor</span>(<span class="include">SimpleController</span>)
<span class="include">class</span> <span class="include">SimpleControllerSpec</span> <span class="include">extends</span> <span class="include">Specification</span> {

    <span class="include">void</span> <span class="string"><span class="delimiter">'</span><span class="content">test valid form submission</span><span class="delimiter">'</span></span>() {
        <span class="include">when</span>:
        <span class="include">def</span> <span class="include">tokenHolder</span> = <span class="include">SynchronizerTokensHolder.store</span>(<span class="include">session</span>)

        <span class="include">params</span>[<span class="include">SynchronizerTokensHolder.TOKEN_URI</span>] = <span class="string"><span class="delimiter">'</span><span class="content">/controller/handleForm</span><span class="delimiter">'</span></span>
        <span class="include">params</span>[<span class="include">SynchronizerTokensHolder.TOKEN_KEY</span>] = <span class="include">tokenHolder.generateToken</span>(<span class="include">params</span>[<span class="include">SynchronizerTokensHolder.TOKEN_URI</span>])
        <span class="include">controller.handleForm</span>()

        <span class="include">then</span>:
        <span class="include">response.text</span> == <span class="string"><span class="delimiter">'</span><span class="content">Good</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you test both the valid and the invalid request in the same test be sure to reset the response between executions of the controller:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">grails.test.mixin.TestFor</span>
<span class="include">import</span> <span class="include">spock.lang.Specification</span>

<span class="include">import</span> <span class="include">org.codehaus.groovy.grails.web.servlet.mvc.SynchronizerTokensHolder</span>

<span class="annotation">@TestFor</span>(<span class="include">SimpleController</span>)
<span class="include">class</span> <span class="include">SimpleControllerSpec</span> <span class="include">extends</span> <span class="include">Specification</span> {

    <span class="include">void</span> <span class="string"><span class="delimiter">'</span><span class="content">test form submission</span><span class="delimiter">'</span></span>() {
        <span class="include">when</span>:
        <span class="include">controller.handleForm</span>()

        <span class="include">then</span>:
        <span class="include">response.text</span> == <span class="string"><span class="delimiter">'</span><span class="content">Bad</span><span class="delimiter">'</span></span>

        <span class="include">when</span>:
        <span class="include">response.reset</span>()
        <span class="include">def</span> <span class="include">tokenHolder</span> = <span class="include">SynchronizerTokensHolder.store</span>(<span class="include">session</span>)

        <span class="include">params</span>[<span class="include">SynchronizerTokensHolder.TOKEN_URI</span>] = <span class="string"><span class="delimiter">'</span><span class="content">/controller/handleForm</span><span class="delimiter">'</span></span>
        <span class="include">params</span>[<span class="include">SynchronizerTokensHolder.TOKEN_KEY</span>] = <span class="include">tokenHolder.generateToken</span>(<span class="include">params</span>[<span class="include">SynchronizerTokensHolder.TOKEN_URI</span>])
        <span class="include">controller.handleForm</span>()

        <span class="include">then</span>:
        <span class="include">response.text</span> == <span class="string"><span class="delimiter">'</span><span class="content">Good</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_testing_file_upload">Testing File Upload</h4>
<div class="paragraph">
<p>You use the <code>GrailsMockMultipartFile</code> class to test file uploads. For example consider the following controller action:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">def uploadFile() {
    MultipartFile file = request.getFile(<span class="string"><span class="delimiter">&quot;</span><span class="content">myFile</span><span class="delimiter">&quot;</span></span>)
    file.transferTo(<span class="keyword">new</span> <span class="predefined-type">File</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/local/disk/myFile</span><span class="delimiter">&quot;</span></span>))
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To test this action you can register a <code>GrailsMockMultipartFile</code> with the request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">grails.test.mixin.TestFor</span>
<span class="include">import</span> <span class="include">spock.lang.Specification</span>

<span class="include">import</span> <span class="include">org.codehaus.groovy.grails.plugins.testing.GrailsMockMultipartFile</span>

<span class="annotation">@TestFor</span>(<span class="include">SimpleController</span>)
<span class="include">class</span> <span class="include">SimpleControllerSpec</span> <span class="include">extends</span> <span class="include">Specification</span> {

    <span class="include">void</span> <span class="string"><span class="delimiter">'</span><span class="content">test file upload</span><span class="delimiter">'</span></span>() {
        <span class="include">when</span>:
        <span class="include">def</span> <span class="include">file</span> = <span class="include">new</span> <span class="include">GrailsMockMultipartFile</span>(<span class="string"><span class="delimiter">'</span><span class="content">myFile</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">some file contents</span><span class="delimiter">'</span></span>.<span class="include">bytes</span>)
        <span class="include">request.addFile</span> <span class="include">file</span>
        <span class="include">controller.uploadFile</span>()

        <span class="include">then</span>:
        <span class="include">file.targetFileLocation.path</span> == <span class="string"><span class="delimiter">'</span><span class="content">/local/disk/myFile</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>GrailsMockMultipartFile</code> constructor arguments are the name and contents of the file. It has a mock implementation of the <code>transferTo</code> method that simply records the <code>targetFileLocation</code> and doesn&#8217;t write to disk.</p>
</div>
</div>
<div class="sect3">
<h4 id="_testing_command_objects">Testing Command Objects</h4>
<div class="paragraph">
<p>Special support exists for testing command object handling with the <code>mockCommandObject</code> method. For example consider the following action:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">class</span> <span class="class">SimpleController</span> {
    def handleCommand(SimpleCommand simple) {
        <span class="keyword">if</span>(simple.hasErrors()) {
            render <span class="string"><span class="delimiter">'</span><span class="content">Bad</span><span class="delimiter">'</span></span>
        } <span class="keyword">else</span> {
            render <span class="string"><span class="delimiter">'</span><span class="content">Good</span><span class="delimiter">'</span></span>
        }
    }
}

<span class="type">class</span> <span class="class">SimpleCommand</span> {
    <span class="predefined-type">String</span> name

    <span class="directive">static</span> constraints = {
        name blank: <span class="predefined-constant">false</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To test this you mock the command object, populate it and then validate it as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">grails.test.mixin.TestFor</span>
<span class="include">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@TestFor</span>(<span class="include">SimpleController</span>)
<span class="include">class</span> <span class="include">SimpleControllerSpec</span> <span class="include">extends</span> <span class="include">Specification</span> {

    <span class="include">void</span> <span class="string"><span class="delimiter">'</span><span class="content">test valid command object</span><span class="delimiter">'</span></span>() {
        <span class="include">given</span>:
        <span class="include">def</span> <span class="include">simpleCommand</span> = <span class="include">new</span> <span class="include">SimpleCommand</span>(<span class="include">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Hugh</span><span class="delimiter">'</span></span>)
        <span class="include">simpleCommand.validate</span>()

        <span class="include">when</span>:
        <span class="include">controller.handleCommand</span>(<span class="include">simpleCommand</span>)

        <span class="include">then</span>:
        <span class="include">response.text</span> == <span class="string"><span class="delimiter">'</span><span class="content">Good</span><span class="delimiter">'</span></span>
    }

    <span class="include">void</span> <span class="string"><span class="delimiter">'</span><span class="content">test invalid command object</span><span class="delimiter">'</span></span>() {
        <span class="include">given</span>:
        <span class="include">def</span> <span class="include">simpleCommand</span> = <span class="include">new</span> <span class="include">SimpleCommand</span>(<span class="include">name</span>: <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>)
        <span class="include">simpleCommand.validate</span>()

        <span class="include">when</span>:
        <span class="include">controller.handleCommand</span>(<span class="include">simpleCommand</span>)

        <span class="include">then</span>:
        <span class="include">response.text</span> == <span class="string"><span class="delimiter">'</span><span class="content">Bad</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The testing framework also supports allowing Grails to create the command object instance automatically.  To test this invoke the no-arg version of the controller action method.  Grails will create an instance of the command object, perform data binding on it using the request parameters and validate the object just like it does in when the application is running.  See the test below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">grails.test.mixin.TestFor</span>
<span class="include">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@TestFor</span>(<span class="include">SimpleController</span>)
<span class="include">class</span> <span class="include">SimpleControllerSpec</span> <span class="include">extends</span> <span class="include">Specification</span> {

    <span class="include">void</span> <span class="string"><span class="delimiter">'</span><span class="content">test valid command object</span><span class="delimiter">'</span></span>() {
        <span class="include">when</span>:
        <span class="include">params.name</span> = <span class="string"><span class="delimiter">'</span><span class="content">Hugh</span><span class="delimiter">'</span></span>
        <span class="include">controller.handleCommand</span>()

        <span class="include">then</span>:
        <span class="include">response.text</span> == <span class="string"><span class="delimiter">'</span><span class="content">Good</span><span class="delimiter">'</span></span>
    }

    <span class="include">void</span> <span class="string"><span class="delimiter">'</span><span class="content">test invalid command object</span><span class="delimiter">'</span></span>() {
        <span class="include">when</span>:
        <span class="include">params.name</span> = <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>
        <span class="include">controller.handleCommand</span>()

        <span class="include">then</span>:
        <span class="include">response.text</span> == <span class="string"><span class="delimiter">'</span><span class="content">Bad</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_testing_allowedmethods">Testing allowedMethods</h4>
<div class="paragraph">
<p>The unit testing environment respects the <a href="#ref-controllers-allowedMethods">allowedMethods</a> property in controllers.  If a controller action is limited to be accessed with certain request methods, the unit test must be constructed to deal with that.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// grails-app/controllers/com/demo/DemoController.groovypackage com.demo</span>

<span class="type">class</span> <span class="class">DemoController</span> {

    <span class="directive">static</span> allowedMethods = [save: <span class="string"><span class="delimiter">'</span><span class="content">POST</span><span class="delimiter">'</span></span>, update: <span class="string"><span class="delimiter">'</span><span class="content">PUT</span><span class="delimiter">'</span></span>, delete: <span class="string"><span class="delimiter">'</span><span class="content">DELETE</span><span class="delimiter">'</span></span>]

    def save() {
        render <span class="string"><span class="delimiter">'</span><span class="content">Save was successful!</span><span class="delimiter">'</span></span>
    }

    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// test/unit/com/demo/DemoControllerSpec.groovy</span>
<span class="keyword">package</span> <span class="namespace">com.demo</span>

<span class="namespace">import</span> <span class="namespace">grails.test.mixin.TestFor</span>
<span class="namespace">import</span> <span class="namespace">spock.lang.Specification</span>
<span class="namespace">import</span> <span class="namespace">static</span> <span class="namespace">javax.servlet.http.HttpServletResponse</span>.*

<span class="annotation">@TestFor</span>(<span class="namespace">DemoController</span>)
<span class="namespace">class</span> <span class="namespace">DemoControllerSpec</span> <span class="namespace">extends</span> <span class="namespace">Specification</span> {

    <span class="namespace">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test a valid request method</span><span class="delimiter">&quot;</span></span>() {
        <span class="namespace">when</span>:
        <span class="namespace">request.method</span> = <span class="string"><span class="delimiter">'</span><span class="content">POST</span><span class="delimiter">'</span></span>
        <span class="namespace">controller.save</span>()

        <span class="namespace">then</span>:
        <span class="namespace">response.status</span> == <span class="namespace">SC_OK</span>
        <span class="namespace">response.text</span> == <span class="string"><span class="delimiter">'</span><span class="content">Save was successful!</span><span class="delimiter">'</span></span>
    }

    <span class="namespace">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test an invalid request method</span><span class="delimiter">&quot;</span></span>() {
        <span class="namespace">when</span>:
        <span class="namespace">request.method</span> = <span class="string"><span class="delimiter">'</span><span class="content">DELETE</span><span class="delimiter">'</span></span>
        <span class="namespace">controller.save</span>()

        <span class="namespace">then</span>:
        <span class="namespace">response.status</span> == <span class="namespace">SC_METHOD_NOT_ALLOWED</span>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_testing_calling_tag_libraries">Testing Calling Tag Libraries</h4>
<div class="paragraph">
<p>You can test calling tag libraries using <code>ControllerUnitTestMixin</code>, although the mechanism for testing the tag called varies from tag to tag. For example to test a call to the <code>message</code> tag, add a message to the <code>messageSource</code>. Consider the following action:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">def showMessage() {
    render g.message(code: <span class="string"><span class="delimiter">&quot;</span><span class="content">foo.bar</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This can be tested as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">grails.test.mixin.TestFor</span>
<span class="include">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@TestFor</span>(<span class="include">SimpleController</span>)
<span class="include">class</span> <span class="include">SimpleControllerSpec</span> <span class="include">extends</span> <span class="include">Specification</span> {

    <span class="include">void</span> <span class="string"><span class="delimiter">'</span><span class="content">test render message tag</span><span class="delimiter">'</span></span>() {
        <span class="include">given</span>:
        <span class="include">messageSource.addMessage</span> <span class="string"><span class="delimiter">'</span><span class="content">foo.bar</span><span class="delimiter">'</span></span>, <span class="include">request.locale</span>, <span class="string"><span class="delimiter">'</span><span class="content">Hello World</span><span class="delimiter">'</span></span>

        <span class="include">when</span>:
        <span class="include">controller.showMessage</span>()

        <span class="include">then</span>:
        <span class="include">response.text</span> == <span class="string"><span class="delimiter">'</span><span class="content">Hello World</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#unitTestingTagLibraries">unit testing tag libraries</a> for more information.</p>
</div>
</div>

<a name="12.1.2 Unit Testing Tag Libraries"><!-- Legacy link --></a>
<h2 id="unitTestingTagLibraries">15.1.2 Unit Testing Tag Libraries</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/tree/master/src/en/guide/testing/unitTesting/unitTestingTagLibraries.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_the_basics">The Basics</h4>
<div class="paragraph">
<p>Tag libraries and GSP pages can be tested with the <code>grails.test.mixin.web.GroovyPageUnitTestMixin</code> mixin. To use the mixin declare which tag library is under test with the <code>TestFor</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">grails.test.mixin.TestFor</span>
<span class="include">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@TestFor</span>(<span class="include">SimpleTagLib</span>)
<span class="include">class</span> <span class="include">SimpleTagLibSpec</span> <span class="include">extends</span> <span class="include">Specification</span> {

    <span class="include">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test something</span><span class="delimiter">&quot;</span></span>() {
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Adding the <code>TestFor</code> annotation to a TagLib class causes a new <code>tagLib</code> field to be automatically created for the TagLib class under test.
The tagLib field can be used to test calling tags as function calls. The return value of a function call is either a <a href="http://docs.grails.org/latest/api/org/grails/buffer/StreamCharBuffer.html">StreamCharBuffer</a> instance or
the object returned from the tag closure when <a href="#tagReturnValue">returnObjectForTags</a> feature is used.</p>
</div>
<div class="paragraph">
<p>Note that if you are testing invocation of a custom tag from a controller you can combine the <code>ControllerUnitTestMixin</code> and the <code>GroovyPageUnitTestMixin</code> using the <code>Mock</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">grails.test.mixin.TestFor</span>
<span class="include">import</span> <span class="include">grails.test.mixin.Mock</span>
<span class="include">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@TestFor</span>(<span class="include">SimpleController</span>)
<span class="annotation">@Mock</span>(<span class="include">SimpleTagLib</span>)
<span class="include">class</span> <span class="include">SimpleControllerSpec</span> <span class="include">extends</span> <span class="include">Specification</span> {

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_testing_custom_tags">Testing Custom Tags</h4>
<div class="paragraph">
<p>The core Grails tags don&#8217;t need to be enabled during testing, however custom tag libraries do. The <code>GroovyPageUnitTestMixin</code> class provides a <code>mockTagLib()</code> method that you can use to mock a custom tag library. For example consider the following tag library:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">class</span> <span class="class">SimpleTagLib</span> {

    <span class="directive">static</span> namespace = <span class="string"><span class="delimiter">'</span><span class="content">s</span><span class="delimiter">'</span></span>

    def hello = { attrs, body -&gt;
        out &lt;&lt; <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello ${attrs.name ?: 'World'}</span><span class="delimiter">&quot;</span></span>
    }

    def bye = { attrs, body -&gt;
        out &lt;&lt; <span class="string"><span class="delimiter">&quot;</span><span class="content">Bye ${attrs.author.name ?: 'World'}</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can test this tag library by using <code>TestFor</code> and supplying the name of the tag library:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">grails.test.mixin.TestFor</span>
<span class="include">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@TestFor</span>(<span class="include">SimpleTagLib</span>)
<span class="include">class</span> <span class="include">SimpleTagLibSpec</span> <span class="include">extends</span> <span class="include">Specification</span> {

    <span class="include">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test hello tag</span><span class="delimiter">&quot;</span></span>() {
        <span class="include">expect</span>:
        <span class="include">applyTemplate</span>(<span class="string"><span class="delimiter">'</span><span class="content">&lt;s:hello /&gt;</span><span class="delimiter">'</span></span>) == <span class="string"><span class="delimiter">'</span><span class="content">Hello World</span><span class="delimiter">'</span></span>
        <span class="include">applyTemplate</span>(<span class="string"><span class="delimiter">'</span><span class="content">&lt;s:hello name=&quot;Fred&quot; /&gt;</span><span class="delimiter">'</span></span>) == <span class="string"><span class="delimiter">'</span><span class="content">Hello Fred</span><span class="delimiter">'</span></span>
        <span class="include">applyTemplate</span>(<span class="string"><span class="delimiter">'</span><span class="content">&lt;s:bye author=&quot;</span><span class="content">\$</span><span class="content">{author}&quot; /&gt;</span><span class="delimiter">'</span></span>, [<span class="include">author</span>: <span class="include">new</span> <span class="include">Author</span>(<span class="include">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Fred</span><span class="delimiter">'</span></span>)]) == <span class="string"><span class="delimiter">'</span><span class="content">Bye Fred</span><span class="delimiter">'</span></span>
    }

    <span class="include">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test tag calls</span><span class="delimiter">&quot;</span></span>() {
        <span class="include">expect</span>:
        <span class="include">tagLib.hello</span>().<span class="include">toString</span>() == <span class="string"><span class="delimiter">'</span><span class="content">Hello World</span><span class="delimiter">'</span></span>
        <span class="include">tagLib.hello</span>(<span class="include">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Fred</span><span class="delimiter">'</span></span>).<span class="include">toString</span>() == <span class="string"><span class="delimiter">'</span><span class="content">Hello Fred</span><span class="delimiter">'</span></span>
        <span class="include">tagLib.bye</span>(<span class="include">author</span>: <span class="include">new</span> <span class="include">Author</span>(<span class="include">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Fred</span><span class="delimiter">'</span></span>)).<span class="include">toString</span> == <span class="string"><span class="delimiter">'</span><span class="content">Bye Fred</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can use the <code>TestMixin</code> annotation and mock multiple tag libraries using the <code>mockTagLib()</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">spock.lang.Specification</span>
<span class="include">import</span> <span class="include">grails.test.mixin.TestMixin</span>
<span class="include">import</span> <span class="include">grails.test.mixin.web.GroovyPageUnitTestMixin</span>

<span class="annotation">@TestMixin</span>(<span class="include">GroovyPageUnitTestMixin</span>)
<span class="include">class</span> <span class="include">MultipleTagLibSpec</span> <span class="include">extends</span> <span class="include">Specification</span> {

    <span class="include">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test multiple tags</span><span class="delimiter">&quot;</span></span>() {
        <span class="include">given</span>:
        <span class="include">mockTagLib</span>(<span class="include">SomeTagLib</span>)
        <span class="include">mockTagLib</span>(<span class="include">SomeOtherTagLib</span>)

        <span class="include">expect</span>:
        <span class="comment">// ...</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>GroovyPageUnitTestMixin</code> provides convenience methods for asserting that the template output equals or matches an expected value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">grails.test.mixin.TestFor</span>
<span class="include">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@TestFor</span>(<span class="include">SimpleTagLib</span>)
<span class="include">class</span> <span class="include">SimpleTagLibSpec</span> <span class="include">extends</span> <span class="include">Specification</span> {

    <span class="include">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test hello tag</span><span class="delimiter">&quot;</span></span>() {
        <span class="include">expect</span>:
        <span class="include">assertOutputEquals</span> (<span class="string"><span class="delimiter">'</span><span class="content">Hello World</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">&lt;s:hello /&gt;</span><span class="delimiter">'</span></span>)
        <span class="include">assertOutputMatches</span> (/.*<span class="include">Fred</span>.*/, <span class="string"><span class="delimiter">'</span><span class="content">&lt;s:hello name=&quot;Fred&quot; /&gt;</span><span class="delimiter">'</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_testing_view_and_template_rendering">Testing View and Template Rendering</h4>
<div class="paragraph">
<p>You can test rendering of views and templates in <code>grails-app/views</code> via the <code>render(Map)</code> method provided by <code>GroovyPageUnitTestMixin</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">spock.lang.Specification</span>
<span class="include">import</span> <span class="include">grails.test.mixin.TestMixin</span>
<span class="include">import</span> <span class="include">grails.test.mixin.web.GroovyPageUnitTestMixin</span>

<span class="annotation">@TestMixin</span>(<span class="include">GroovyPageUnitTestMixin</span>)
<span class="include">class</span> <span class="include">RenderingSpec</span> <span class="include">extends</span> <span class="include">Specification</span> {

    <span class="include">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test rendering template</span><span class="delimiter">&quot;</span></span>() {
        <span class="include">when</span>:
        <span class="include">def</span> <span class="include">result</span> = <span class="include">render</span>(<span class="include">template</span>: <span class="string"><span class="delimiter">'</span><span class="content">/simple/hello</span><span class="delimiter">'</span></span>)

        <span class="include">then</span>:
        <span class="include">result</span> == <span class="string"><span class="delimiter">'</span><span class="content">Hello World!</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will attempt to render a template found at the location <code>grails-app/views/simple/_hello.gsp</code>. Note that if the template depends on any custom tag libraries you need to call <code>mockTagLib</code> as described in the previous section.</p>
</div>
<div class="paragraph">
<p>Some core tags use the active controller and action as input. In GroovyPageUnitTestMixin tests, you can manually set the active controller and action name by setting controllerName and actionName properties on the webRequest object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">webRequest.controllerName = <span class="string"><span class="delimiter">'</span><span class="content">simple</span><span class="delimiter">'</span></span>
    webRequest.actionName = <span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>

<a name="12.1.3 Unit Testing Domains"><!-- Legacy link --></a>
<h2 id="unitTestingDomains">15.1.3 Unit Testing Domains</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/tree/master/src/en/guide/testing/unitTesting/unitTestingDomains.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_overview">Overview</h4>
<div class="paragraph">
<p>Domain class interaction can be tested without involving a real database connection using <code>DomainClassUnitTestMixin</code> or by using the <code>HibernateTestMixin</code>.</p>
</div>
<div class="paragraph">
<p>The GORM implementation in DomainClassUnitTestMixin is using a simple in-memory <code>ConcurrentHashMap</code> implementation. Note that this has limitations compared to a real GORM implementation.</p>
</div>
<div class="paragraph">
<p>A large, commonly-used portion of the GORM API can be mocked using <code>DomainClassUnitTestMixin</code> including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Simple persistence methods like <code>save()</code>, <code>delete()</code> etc.</p>
</li>
<li>
<p>Dynamic Finders</p>
</li>
<li>
<p>Named Queries</p>
</li>
<li>
<p>Query-by-example</p>
</li>
<li>
<p>GORM Events</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>HibernateTestMixin</code> uses Hibernate 4 and a H2 in-memory database. This makes it possible to use all GORM features also in Grails unit tests.</p>
</div>
<div class="paragraph">
<p>All features of GORM for Hibernate can be tested within a <code>HibernateTestMixin</code> unit test including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>String-based HQL queries</p>
</li>
<li>
<p>composite identifiers</p>
</li>
<li>
<p>dirty checking methods</p>
</li>
<li>
<p>any direct interaction with Hibernate</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The implementation behind <code>HibernateTestMixin</code> takes care of setting up the Hibernate with the in-memory H2 database. It only configures the given domain classes for use in a unit test. The @Domain annotation is used to tell which domain classes should be configured.</p>
</div>
</div>
<div class="sect3">
<h4 id="_domainclassunittestmixin_basics">DomainClassUnitTestMixin Basics</h4>
<div class="paragraph">
<p><code>DomainClassUnitTestMixin</code> is typically used in combination with testing either a controller, service or tag library where the domain is a mock collaborator defined by the <code>Mock</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">grails.test.mixin.TestFor</span>
<span class="include">import</span> <span class="include">grails.test.mixin.Mock</span>
<span class="include">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@TestFor</span>(<span class="include">BookController</span>)
<span class="annotation">@Mock</span>(<span class="include">Book</span>)
<span class="include">class</span> <span class="include">BookControllerSpec</span> <span class="include">extends</span> <span class="include">Specification</span> {
    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above tests the <code>SimpleController</code> class and mocks the behavior of the <code>Simple</code> domain class as well. For example consider a typical scaffolded <code>save</code> controller action:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">class</span> <span class="class">BookController</span> {
    def save() {
        def book = <span class="keyword">new</span> <span class="predefined-type">Book</span>(params)
        <span class="keyword">if</span> (book.save(flush: <span class="predefined-constant">true</span>)) {
            flash.message = message(
                    code: <span class="string"><span class="delimiter">'</span><span class="content">default.created.message</span><span class="delimiter">'</span></span>,
                    args: [message(code: <span class="string"><span class="delimiter">'</span><span class="content">book.label</span><span class="delimiter">'</span></span>, <span class="keyword">default</span>: <span class="string"><span class="delimiter">'</span><span class="content">Book</span><span class="delimiter">'</span></span>), book.id])
            redirect(action: <span class="string"><span class="delimiter">&quot;</span><span class="content">show</span><span class="delimiter">&quot;</span></span>, id: book.id)
        }
        <span class="keyword">else</span> {
            render(view: <span class="string"><span class="delimiter">&quot;</span><span class="content">create</span><span class="delimiter">&quot;</span></span>, model: [bookInstance: book])
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Tests for this action can be written as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">grails.test.mixin.TestFor</span>
<span class="include">import</span> <span class="include">grails.test.mixin.Mock</span>
<span class="include">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@TestFor</span>(<span class="include">BookController</span>)
<span class="annotation">@Mock</span>(<span class="include">Book</span>)
<span class="include">class</span> <span class="include">BookControllerSpec</span> <span class="include">extends</span> <span class="include">Specification</span> {
   <span class="include">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test saving an invalid book</span><span class="delimiter">&quot;</span></span>() {
        <span class="include">when</span>:
        <span class="include">controller.save</span>()

        <span class="include">then</span>:
        <span class="include">model.bookInstance</span> != <span class="include">null</span>
        <span class="include">view</span> == <span class="string"><span class="delimiter">'</span><span class="content">/book/create</span><span class="delimiter">'</span></span>
    }

    <span class="include">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test saving a valid book</span><span class="delimiter">&quot;</span></span>() {
        <span class="include">when</span>:
        <span class="include">params.title</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">The Stand</span><span class="delimiter">&quot;</span></span>
        <span class="include">params.pages</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">500</span><span class="delimiter">&quot;</span></span>

        <span class="include">controller.save</span>()

        <span class="include">then</span>:
        <span class="include">response.redirectedUrl</span> == <span class="string"><span class="delimiter">'</span><span class="content">/book/show/1</span><span class="delimiter">'</span></span>
        <span class="include">flash.message</span> != <span class="include">null</span>
        <span class="include">Book.count</span>() == <span class="integer">1</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Mock</code> annotation also supports a list of mock collaborators if you have more than one domain to mock:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">grails.test.mixin.TestFor</span>
<span class="include">import</span> <span class="include">grails.test.mixin.Mock</span>
<span class="include">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@TestFor</span>(<span class="include">BookController</span>)
<span class="annotation">@Mock</span>([<span class="include">Book</span>, <span class="include">Author</span>])
<span class="include">class</span> <span class="include">BookControllerSpec</span> <span class="include">extends</span> <span class="include">Specification</span> {
    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively you can also use the <code>DomainClassUnitTestMixin</code> directly with the <code>TestMixin</code> annotation and then call the <code>mockDomain</code> method to mock domains during your test:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">grails.test.mixin.TestFor</span>
<span class="include">import</span> <span class="include">grails.test.mixin.TestMixin</span>
<span class="include">import</span> <span class="include">spock.lang.Specification</span>
<span class="include">import</span> <span class="include">grails.test.mixin.domain.DomainClassUnitTestMixin</span>

<span class="annotation">@TestFor</span>(<span class="include">BookController</span>)
<span class="annotation">@TestMixin</span>(<span class="include">DomainClassUnitTestMixin</span>)
<span class="include">class</span> <span class="include">BookControllerSpec</span> <span class="include">extends</span> <span class="include">Specification</span> {

    <span class="include">void</span> <span class="include">setupSpec</span>() {
         <span class="include">mockDomain</span>(<span class="include">Book</span>)
    }

    <span class="include">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test saving an invalid book</span><span class="delimiter">&quot;</span></span>() {
        <span class="include">when</span>:
        <span class="include">controller.save</span>()

        <span class="include">then</span>:
        <span class="include">model.bookInstance</span> != <span class="include">null</span>
        <span class="include">view</span> == <span class="string"><span class="delimiter">'</span><span class="content">/book/create</span><span class="delimiter">'</span></span>
    }

    <span class="include">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test saving a valid book</span><span class="delimiter">&quot;</span></span>() {
        <span class="include">when</span>:
        <span class="include">params.title</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">The Stand</span><span class="delimiter">&quot;</span></span>
        <span class="include">params.pages</span> = <span class="string"><span class="delimiter">&quot;</span><span class="content">500</span><span class="delimiter">&quot;</span></span>

        <span class="include">controller.save</span>()

        <span class="include">then</span>:
        <span class="include">response.redirectedUrl</span> == <span class="string"><span class="delimiter">'</span><span class="content">/book/show/1</span><span class="delimiter">'</span></span>
        <span class="include">flash.message</span> != <span class="include">null</span>
        <span class="include">Book.count</span>() == <span class="integer">1</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>mockDomain</code> method also includes an additional parameter that lets you pass a Map of Maps to configure a domain, which is useful for fixture-like data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">mockDomain(<span class="predefined-type">Book</span>, [
            [title: <span class="string"><span class="delimiter">&quot;</span><span class="content">The Stand</span><span class="delimiter">&quot;</span></span>, pages: <span class="integer">1000</span>],
            [title: <span class="string"><span class="delimiter">&quot;</span><span class="content">The Shining</span><span class="delimiter">&quot;</span></span>, pages: <span class="integer">400</span>],
            [title: <span class="string"><span class="delimiter">&quot;</span><span class="content">Along Came a Spider</span><span class="delimiter">&quot;</span></span>, pages: <span class="integer">300</span>] ])</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_testing_constraints">Testing Constraints</h4>
<div class="paragraph">
<p>There are 3 types of validateable classes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Domain classes</p>
</li>
<li>
<p>Classes which implement the <code>Validateable</code> trait</p>
</li>
<li>
<p>Command Objects which have been made validateable automatically</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These are all easily testable in a unit test with no special configuration necessary as long as the test method is marked with <code>TestFor</code> or explicitly applies the <code>GrailsUnitTestMixin</code> using <code>TestMixin</code>.  See the examples below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// src/groovy/com/demo/MyValidateable.groovy</span>
<span class="keyword">package</span> <span class="namespace">com.demo</span>

<span class="namespace">class</span> <span class="namespace">MyValidateable</span> <span class="namespace">implements</span> <span class="namespace">grails.validation.Validateable</span> {
    <span class="namespace">String</span> <span class="namespace">name</span>
    <span class="namespace">Integer</span> <span class="namespace">age</span>

    <span class="namespace">static</span> <span class="namespace">constraints</span> = {
        <span class="namespace">name</span> <span class="namespace">matches</span>: /[<span class="namespace">A</span>-<span class="namespace">Z</span>].*/
        <span class="namespace">age</span> <span class="namespace">range</span>: <span class="integer">1</span>.<span class="float">.99</span>
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// grails-app/domain/com/demo/Person.groovy</span>
<span class="keyword">package</span> <span class="namespace">com.demo</span>

<span class="namespace">class</span> <span class="namespace">Person</span> {
    <span class="namespace">String</span> <span class="namespace">name</span>

    <span class="namespace">static</span> <span class="namespace">constraints</span> = {
        <span class="namespace">name</span> <span class="namespace">matches</span>: /[<span class="namespace">A</span>-<span class="namespace">Z</span>].*/
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// grails-app/controllers/com/demo/DemoController.groovy</span>
<span class="keyword">package</span> <span class="namespace">com.demo</span>

<span class="namespace">class</span> <span class="namespace">DemoController</span> {

    <span class="namespace">def</span> <span class="namespace">addItems</span>(<span class="namespace">MyCommandObject</span> <span class="namespace">co</span>) {
        <span class="namespace">if</span>(<span class="namespace">co.hasErrors</span>()) {
            <span class="namespace">render</span> <span class="string"><span class="delimiter">'</span><span class="content">something went wrong</span><span class="delimiter">'</span></span>
        } <span class="namespace">else</span> {
            <span class="namespace">render</span> <span class="string"><span class="delimiter">'</span><span class="content">items have been added</span><span class="delimiter">'</span></span>
        }
    }
}

<span class="namespace">class</span> <span class="namespace">MyCommandObject</span> {
    <span class="namespace">Integer</span> <span class="namespace">numberOfItems</span>

    <span class="namespace">static</span> <span class="namespace">constraints</span> = {
        <span class="namespace">numberOfItems</span> <span class="namespace">range</span>: <span class="integer">1</span>.<span class="float">.10</span>
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// test/unit/com/demo/PersonSpec.groovy</span>
<span class="keyword">package</span> <span class="namespace">com.demo</span>

<span class="namespace">import</span> <span class="namespace">grails.test.mixin.TestFor</span>
<span class="namespace">import</span> <span class="namespace">spock.lang.Specification</span>

<span class="annotation">@TestFor</span>(<span class="namespace">Person</span>)
<span class="namespace">class</span> <span class="namespace">PersonSpec</span> <span class="namespace">extends</span> <span class="namespace">Specification</span> {

    <span class="namespace">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Test that name must begin with an upper case letter</span><span class="delimiter">&quot;</span></span>() {
        <span class="namespace">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">the name begins with a lower letter</span><span class="delimiter">'</span></span>
        <span class="namespace">def</span> <span class="namespace">p</span> = <span class="namespace">new</span> <span class="namespace">Person</span>(<span class="namespace">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">jeff</span><span class="delimiter">'</span></span>)

        <span class="namespace">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">validation should fail</span><span class="delimiter">'</span></span>
        !<span class="namespace">p.validate</span>()

        <span class="namespace">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">the name begins with an upper case letter</span><span class="delimiter">'</span></span>
        <span class="namespace">p</span> = <span class="namespace">new</span> <span class="namespace">Person</span>(<span class="namespace">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Jeff</span><span class="delimiter">'</span></span>)

        <span class="namespace">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">validation should pass</span><span class="delimiter">'</span></span>
        <span class="namespace">p.validate</span>()
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// test/unit/com/demo/DemoControllerSpec.groovy</span>
<span class="keyword">package</span> <span class="namespace">com.demo</span>

<span class="namespace">import</span> <span class="namespace">grails.test.mixin.TestFor</span>
<span class="namespace">import</span> <span class="namespace">spock.lang.Specification</span>

<span class="annotation">@TestFor</span>(<span class="namespace">DemoController</span>)
<span class="namespace">class</span> <span class="namespace">DemoControllerSpec</span> <span class="namespace">extends</span> <span class="namespace">Specification</span> {

    <span class="namespace">void</span> <span class="string"><span class="delimiter">'</span><span class="content">Test an invalid number of items</span><span class="delimiter">'</span></span>() {
        <span class="namespace">when</span>:
        <span class="namespace">params.numberOfItems</span> = <span class="integer">42</span>
        <span class="namespace">controller.addItems</span>()

        <span class="namespace">then</span>:
        <span class="namespace">response.text</span> == <span class="string"><span class="delimiter">'</span><span class="content">something went wrong</span><span class="delimiter">'</span></span>
    }

    <span class="namespace">void</span> <span class="string"><span class="delimiter">'</span><span class="content">Test a valid number of items</span><span class="delimiter">'</span></span>() {
        <span class="namespace">when</span>:
        <span class="namespace">params.numberOfItems</span> = <span class="integer">8</span>
        <span class="namespace">controller.addItems</span>()

        <span class="namespace">then</span>:
        <span class="namespace">response.text</span> == <span class="string"><span class="delimiter">'</span><span class="content">items have been added</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// test/unit/com/demo/MyValidateableSpec.groovy</span>
<span class="keyword">package</span> <span class="namespace">com.demo</span>

<span class="namespace">import</span> <span class="namespace">grails.test.mixin.TestMixin</span>
<span class="namespace">import</span> <span class="namespace">grails.test.mixin.support.GrailsUnitTestMixin</span>
<span class="namespace">import</span> <span class="namespace">spock.lang.Specification</span>


<span class="annotation">@TestMixin</span>(<span class="namespace">GrailsUnitTestMixin</span>)
<span class="namespace">class</span> <span class="namespace">MyValidateableSpec</span> <span class="namespace">extends</span> <span class="namespace">Specification</span> {

    <span class="namespace">void</span> <span class="string"><span class="delimiter">'</span><span class="content">Test validate can be invoked in a unit test with no special configuration</span><span class="delimiter">'</span></span>() {
        <span class="namespace">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">an object is valid</span><span class="delimiter">'</span></span>
        <span class="namespace">def</span> <span class="namespace">validateable</span> = <span class="namespace">new</span> <span class="namespace">MyValidateable</span>(<span class="namespace">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Kirk</span><span class="delimiter">'</span></span>, <span class="namespace">age</span>: <span class="integer">47</span>)

        <span class="namespace">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">validate() returns true and there are no errors</span><span class="delimiter">'</span></span>
        <span class="namespace">validateable.validate</span>()
        !<span class="namespace">validateable.hasErrors</span>()
        <span class="namespace">validateable.errors.errorCount</span> == <span class="integer">0</span>

        <span class="namespace">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">an object is invalid</span><span class="delimiter">'</span></span>
        <span class="namespace">validateable.name</span> = <span class="string"><span class="delimiter">'</span><span class="content">kirk</span><span class="delimiter">'</span></span>

        <span class="namespace">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">validate() returns false and the appropriate error is created</span><span class="delimiter">'</span></span>
        !<span class="namespace">validateable.validate</span>()
        <span class="namespace">validateable.hasErrors</span>()
        <span class="namespace">validateable.errors.errorCount</span> == <span class="integer">1</span>
        <span class="namespace">validateable.errors</span>[<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>].<span class="namespace">code</span> == <span class="string"><span class="delimiter">'</span><span class="content">matches.invalid</span><span class="delimiter">'</span></span>

        <span class="namespace">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">the clearErrors() is called</span><span class="delimiter">'</span></span>
        <span class="namespace">validateable.clearErrors</span>()

        <span class="namespace">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">the errors are gone</span><span class="delimiter">'</span></span>
        !<span class="namespace">validateable.hasErrors</span>()
        <span class="namespace">validateable.errors.errorCount</span> == <span class="integer">0</span>

        <span class="namespace">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">the object is put back in a valid state</span><span class="delimiter">'</span></span>
        <span class="namespace">validateable.name</span> = <span class="string"><span class="delimiter">'</span><span class="content">Kirk</span><span class="delimiter">'</span></span>

        <span class="namespace">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">validate() returns true and there are no errors</span><span class="delimiter">'</span></span>
        <span class="namespace">validateable.validate</span>()
        !<span class="namespace">validateable.hasErrors</span>()
        <span class="namespace">validateable.errors.errorCount</span> == <span class="integer">0</span>
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// test/unit/com/demo/MyCommandObjectSpec.groovy</span>
<span class="keyword">package</span> <span class="namespace">com.demo</span>

<span class="namespace">import</span> <span class="namespace">grails.test.mixin.TestMixin</span>
<span class="namespace">import</span> <span class="namespace">grails.test.mixin.support.GrailsUnitTestMixin</span>
<span class="namespace">import</span> <span class="namespace">spock.lang.Specification</span>

<span class="annotation">@TestMixin</span>(<span class="namespace">GrailsUnitTestMixin</span>)
<span class="namespace">class</span> <span class="namespace">MyCommandObjectSpec</span> <span class="namespace">extends</span> <span class="namespace">Specification</span> {

    <span class="namespace">void</span> <span class="string"><span class="delimiter">'</span><span class="content">Test that numberOfItems must be between 1 and 10</span><span class="delimiter">'</span></span>() {
        <span class="namespace">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">numberOfItems is less than 1</span><span class="delimiter">'</span></span>
        <span class="namespace">def</span> <span class="namespace">co</span> = <span class="namespace">new</span> <span class="namespace">MyCommandObject</span>()
        <span class="namespace">co.numberOfItems</span> = <span class="integer">0</span>

        <span class="namespace">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">validation fails</span><span class="delimiter">'</span></span>
        !<span class="namespace">co.validate</span>()
        <span class="namespace">co.hasErrors</span>()
        <span class="namespace">co.errors</span>[<span class="string"><span class="delimiter">'</span><span class="content">numberOfItems</span><span class="delimiter">'</span></span>].<span class="namespace">code</span> == <span class="string"><span class="delimiter">'</span><span class="content">range.toosmall</span><span class="delimiter">'</span></span>

        <span class="namespace">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">numberOfItems is greater than 10</span><span class="delimiter">'</span></span>
        <span class="namespace">co.numberOfItems</span> = <span class="integer">11</span>

        <span class="namespace">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">validation fails</span><span class="delimiter">'</span></span>
        !<span class="namespace">co.validate</span>()
        <span class="namespace">co.hasErrors</span>()
        <span class="namespace">co.errors</span>[<span class="string"><span class="delimiter">'</span><span class="content">numberOfItems</span><span class="delimiter">'</span></span>].<span class="namespace">code</span> == <span class="string"><span class="delimiter">'</span><span class="content">range.toobig</span><span class="delimiter">'</span></span>

        <span class="namespace">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">numberOfItems is greater than 1</span><span class="delimiter">'</span></span>
        <span class="namespace">co.numberOfItems</span> = <span class="integer">1</span>

        <span class="namespace">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">validation succeeds</span><span class="delimiter">'</span></span>
        <span class="namespace">co.validate</span>()
        !<span class="namespace">co.hasErrors</span>()

        <span class="namespace">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">numberOfItems is greater than 10</span><span class="delimiter">'</span></span>
        <span class="namespace">co.numberOfItems</span> = <span class="integer">10</span>

        <span class="namespace">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">validation succeeds</span><span class="delimiter">'</span></span>
        <span class="namespace">co.validate</span>()
        !<span class="namespace">co.hasErrors</span>()
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s it for testing constraints. One final thing we would like to say is that testing the constraints in this way catches a common error: typos in the "constraints" property name which is a mistake that is easy to make and equally easy to overlook. A unit test for your constraints will highlight the problem straight away.</p>
</div>
</div>
<div class="sect3">
<h4 id="_hibernatetestmixin_basics">HibernateTestMixin Basics</h4>
<div class="paragraph">
<p><code>HibernateTestMixin</code> allows Hibernate 4 to be used in Grails unit tests. It uses a H2 in-memory database.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.test.mixin.TestMixin</span>
<span class="keyword">import</span> <span class="include">grails.test.mixin.gorm.Domain</span>
<span class="keyword">import</span> <span class="include">grails.test.mixin.hibernate.HibernateTestMixin</span>
<span class="keyword">import</span> <span class="include">spock.lang.Specification</span>


<span class="annotation">@Domain</span>(Person)
<span class="annotation">@TestMixin</span>(HibernateTestMixin)
<span class="type">class</span> <span class="class">PersonSpec</span> <span class="directive">extends</span> Specification {

    <span class="type">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Test count people</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">expect</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Test execute Hibernate count query</span><span class="delimiter">&quot;</span></span>
            Person.count() == <span class="integer">0</span>
            sessionFactory != <span class="predefined-constant">null</span>
            transactionManager != <span class="predefined-constant">null</span>
            hibernateSession != <span class="predefined-constant">null</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This library dependency is required in build.gradle for adding support for <code>HibernateTestMixin</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
        testCompile <span class="string"><span class="delimiter">'</span><span class="content">org.grails:grails-datastore-test-support:4.0.4.RELEASE</span><span class="delimiter">'</span></span>
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>HibernateTestMixin is only supported with hibernate4 plugin versions &gt;= 4.3.8.1 .</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
        compile <span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails.plugins:hibernate:4.3.8.1</span><span class="delimiter">&quot;</span></span>
    }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_domain_classes_for_hibernatetestmixin_tests">Configuring domain classes for HibernateTestMixin tests</h4>
<div class="paragraph">
<p>The <code>grails.test.mixin.gorm.Domain</code> annotation is used to configure the list of domain classes to configure for Hibernate sessionFactory instance that gets configured when the unit test runtime is initialized.</p>
</div>
<div class="paragraph">
<p><code>Domain</code> annotations will be collected from several locations:
* the annotations on the test class
* the package annotations in the package-info.java/package-info.groovy file in the package of the test class
* each super class of the test class and their respective package annotations
* the possible <code><a href="http://docs.grails.org/latest/api/grails/test/runtime/SharedRuntime.html">SharedRuntime</a></code> class</p>
</div>
<div class="paragraph">
<p><code>Domain</code> annotations can be shared by adding them as package annotations to package-info.java/package-info.groovy files or by adding them to a <code><a href="http://docs.grails.org/latest/api/grails/test/runtime/SharedRuntime.html">SharedRuntime</a></code> class which has been added for the test.</p>
</div>
<div class="paragraph">
<p>It&#8217;s not possible to use DomainClassUnitTestMixin&#8217;s <code>Mock</code> annotation in HibernateTestMixin tests. Use the <code>Domain</code> annotation in the place of <code>Mock</code> in HibernateTestMixin tests.</p>
</div>
</div>

<a name="12.1.4 Unit Testing Filters"><!-- Legacy link --></a>
<h2 id="unitTestingFilters">15.1.4 Unit Testing Filters</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/tree/master/src/en/guide/testing/unitTesting/unitTestingFilters.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Unit testing filters is typically a matter of testing a controller where a filter is a mock collaborator. For example consider the following filters class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">class</span> <span class="class">CancellingFilters</span> {
    def filters = {
        all(controller:<span class="string"><span class="delimiter">&quot;</span><span class="content">simple</span><span class="delimiter">&quot;</span></span>, action:<span class="string"><span class="delimiter">&quot;</span><span class="content">list</span><span class="delimiter">&quot;</span></span>) {
            before = {
                redirect(controller:<span class="string"><span class="delimiter">&quot;</span><span class="content">book</span><span class="delimiter">&quot;</span></span>)
                <span class="keyword">return</span> <span class="predefined-constant">false</span>
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This filter interceptors the <code>list</code> action of the <code>simple</code> controller and redirects to the <code>book</code> controller. To test this filter you start off with a test that targets the <code>SimpleController</code> class and add the <code>CancellingFilters</code> as a mock collaborator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">grails.test.mixin.TestFor</span>
<span class="include">import</span> <span class="include">grails.test.mixin.Mock</span>
<span class="include">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@TestFor</span>(<span class="include">SimpleController</span>)
<span class="annotation">@Mock</span>(<span class="include">CancellingFilters</span>)
<span class="include">class</span> <span class="include">SimpleControllerSpec</span> <span class="include">extends</span> <span class="include">Specification</span> {

    <span class="comment">// ...</span>

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then implement a test that uses the <code>withFilters</code> method to wrap the call to an action in filter execution:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">grails.test.mixin.TestFor</span>
<span class="include">import</span> <span class="include">grails.test.mixin.Mock</span>
<span class="include">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@TestFor</span>(<span class="include">SimpleController</span>)
<span class="annotation">@Mock</span>(<span class="include">CancellingFilters</span>)
<span class="include">class</span> <span class="include">SimpleControllerSpec</span> <span class="include">extends</span> <span class="include">Specification</span> {

    <span class="include">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test list action is filtered</span><span class="delimiter">&quot;</span></span>() {
        <span class="include">when</span>:
        <span class="include">withFilters</span>(<span class="include">action</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">list</span><span class="delimiter">&quot;</span></span>) {
            <span class="include">controller.list</span>()
        }

        <span class="include">then</span>:
        <span class="include">response.redirectedUrl</span> == <span class="string"><span class="delimiter">'</span><span class="content">/book</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>action</code> parameter is required because it is unknown what the action to invoke is until the action is actually called. The <code>controller</code> parameter is optional and taken from the controller under test. If it is another controller you are testing then you can specify it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">withFilters(controller:<span class="string"><span class="delimiter">&quot;</span><span class="content">book</span><span class="delimiter">&quot;</span></span>,action:<span class="string"><span class="delimiter">&quot;</span><span class="content">list</span><span class="delimiter">&quot;</span></span>) {
    controller.list()
}</code></pre>
</div>
</div>

<a name="12.1.5 Unit Testing URL Mappings"><!-- Legacy link --></a>
<h2 id="unitTestingURLMappings">15.1.5 Unit Testing URL Mappings</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/tree/master/src/en/guide/testing/unitTesting/unitTestingURLMappings.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_the_basics">The Basics</h4>
<div class="paragraph">
<p>Testing URL mappings can be done with the <code>TestFor</code> annotation testing a particular URL mappings class. For example to test the default URL mappings you can do the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">com.demo.SimpleController</span>
<span class="include">import</span> <span class="include">grails.test.mixin.TestFor</span>
<span class="include">import</span> <span class="include">grails.test.mixin.Mock</span>
<span class="include">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@TestFor</span>(<span class="include">UrlMappings</span>)
<span class="annotation">@Mock</span>(<span class="include">SimpleController</span>)
<span class="include">class</span> <span class="include">UrlMappingsSpec</span> <span class="include">extends</span> <span class="include">Specification</span> {
    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, any controller that is the target of a URL mapping that you&#8217;re testing <em>must</em> be added to the `\`Mock@ annotation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Note that since the default <code>UrlMappings</code> class is in the default package your test must also be in the default package
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With that done there are a number of useful methods that are defined by the <code>grails.test.mixin.web.UrlMappingsUnitTestMixin</code> for testing URL mappings. These include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>assertForwardUrlMapping</code> - Asserts a URL mapping is forwarded for the given controller class (note that controller will need to be defined as a mock collaborate for this to work)</p>
</li>
<li>
<p><code>assertReverseUrlMapping</code> - Asserts that the given URL is produced when reverse mapping a link to a given controller and action</p>
</li>
<li>
<p><code>assertUrlMapping</code> - Asserts a URL mapping is valid for the given URL. This combines the <code>assertForwardUrlMapping</code> and <code>assertReverseUrlMapping</code> assertions</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_asserting_forward_url_mappings">Asserting Forward URL Mappings</h4>
<div class="paragraph">
<p>You use <code>assertForwardUrlMapping</code> to assert that a given URL maps to a given controller. For example, consider the following URL mappings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">static</span> mappings = {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">/actionOne</span><span class="delimiter">&quot;</span></span>(controller: <span class="string"><span class="delimiter">&quot;</span><span class="content">simple</span><span class="delimiter">&quot;</span></span>, action: <span class="string"><span class="delimiter">&quot;</span><span class="content">action1</span><span class="delimiter">&quot;</span></span>)
    <span class="string"><span class="delimiter">&quot;</span><span class="content">/actionTwo</span><span class="delimiter">&quot;</span></span>(controller: <span class="string"><span class="delimiter">&quot;</span><span class="content">simple</span><span class="delimiter">&quot;</span></span>, action: <span class="string"><span class="delimiter">&quot;</span><span class="content">action2</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following test can be written to assert these URL mappings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">com.demo.SimpleController</span>
<span class="include">import</span> <span class="include">grails.test.mixin.TestFor</span>
<span class="include">import</span> <span class="include">grails.test.mixin.Mock</span>
<span class="include">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@TestFor</span>(<span class="include">UrlMappings</span>)
<span class="annotation">@Mock</span>(<span class="include">SimpleController</span>)
<span class="include">class</span> <span class="include">UrlMappingsSpec</span> <span class="include">extends</span> <span class="include">Specification</span> {

    <span class="include">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test forward mappings</span><span class="delimiter">&quot;</span></span>() {
        <span class="include">expect</span>:
        <span class="include">assertForwardUrlMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/actionOne</span><span class="delimiter">&quot;</span></span>, <span class="include">controller</span>: <span class="string"><span class="delimiter">'</span><span class="content">simple</span><span class="delimiter">'</span></span>, <span class="include">action</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">action1</span><span class="delimiter">&quot;</span></span>)
        <span class="include">assertForwardUrlMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/actionTwo</span><span class="delimiter">&quot;</span></span>, <span class="include">controller</span>: <span class="string"><span class="delimiter">'</span><span class="content">simple</span><span class="delimiter">'</span></span>, <span class="include">action</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">action2</span><span class="delimiter">&quot;</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_assert_reverse_url_mappings">Assert Reverse URL Mappings</h4>
<div class="paragraph">
<p>You use <code>assertReverseUrlMapping</code> to check that correct links are produced for your URL mapping when using the <code>link</code> tag in GSP views. An example test is largely identical to the previous listing except you use <code>assertReverseUrlMapping</code> instead of <code>assertForwardUrlMapping</code>. Note that you can combine these 2 assertions with <code>assertUrlMapping</code>.</p>
</div>
</div>

<a name="12.1.6 Mocking Collaborators"><!-- Legacy link --></a>
<h2 id="mockingCollaborators">15.1.6 Mocking Collaborators</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/tree/master/src/en/guide/testing/unitTesting/mockingCollaborators.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The Spock Framework manual has a chapter on <a href="http://spockframework.github.io/spock/docs/1.0/interaction_based_testing.html">Interaction Based Testing</a> which also explains mocking collaborators.</p>
</div>

<a name="12.1.7 Mocking Codecs"><!-- Legacy link --></a>
<h2 id="mockingCodecs">15.1.7 Mocking Codecs</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/tree/master/src/en/guide/testing/unitTesting/mockingCodecs.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <code>GrailsUnitTestMixin</code> provides a <code>mockCodec</code> method for mocking <a href="#codecs">custom codecs</a> which may be invoked while a unit test is running.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">mockCodec(MyCustomCodec)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Failing to mock a codec which is invoked while a unit test is running may result in a MissingMethodException.</p>
</div>

<a name="12.1.8 Unit Test Metaprogramming"><!-- Legacy link --></a>
<h2 id="unitTestMetaprogramming">15.1.8 Unit Test Metaprogramming</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/tree/master/src/en/guide/testing/unitTesting/unitTestMetaprogramming.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>If runtime metaprogramming needs to be done in a unit test it needs to be done early in the process before the unit testing environment is fully initialized.  This should be done when the unit test class is being initialized.  For a Spock based test this should be done in the <code>setupSpec()</code> method.  For a JUnit test this should be done in a method marked with `\`BeforeClass@.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">myapp</span>

<span class="namespace">import</span> <span class="namespace">grails.test.mixin</span>.*
<span class="namespace">import</span> <span class="namespace">spock.lang.Specification</span>

<span class="annotation">@TestFor</span>(<span class="namespace">SomeController</span>)
<span class="namespace">class</span> <span class="namespace">SomeControllerSpec</span> <span class="namespace">extends</span> <span class="namespace">Specification</span> {


    <span class="namespace">def</span> <span class="namespace">setupSpec</span>() {
        <span class="namespace">SomeClass.metaClass.someMethod</span> = { -&gt;
            <span class="comment">// do something here</span>
        }
    }

    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">myapp</span>

<span class="namespace">import</span> <span class="namespace">grails.test.mixin</span>.*
<span class="namespace">import</span> <span class="namespace">org.junit</span>.*

<span class="annotation">@TestFor</span>(<span class="namespace">SomeController</span>)
<span class="namespace">class</span> <span class="namespace">SomeControllerTests</span> {

    <span class="annotation">@BeforeClass</span>
    <span class="namespace">static</span> <span class="namespace">void</span> <span class="namespace">metaProgramController</span>() {
        <span class="namespace">SomeClass.metaClass.someMethod</span> = { -&gt;
            <span class="comment">// do something here</span>
        }
    }

    <span class="comment">// ...</span>

}</code></pre>
</div>
</div>


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../../guide/staticTypeCheckingAndCompilation.html">&lt;&lt; <strong>14</strong><span>Static Type Checking And Compilation</span></a></div>
                
                    <div class="toc-item next-right"><a href="../../guide/i18n.html"><strong>16</strong><span>Internationalization</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Command Line</h1><div class="menu-sub">
                        
                            <div class="menu-item"><a href="../../ref/Command%20Line/Usage.html">Usage</a></div>
                            
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/bug-report.html">bug-report</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/clean.html">clean</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/compile.html">compile</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/console.html">console</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/create-app.html">create-app</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/create-command.html">create-command</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/create-controller.html">create-controller</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/create-domain-class.html">create-domain-class</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/create-functional-test.html">create-functional-test</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/create-hibernate-cfg-xml.html">create-hibernate-cfg-xml</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/create-integration-test.html">create-integration-test</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/create-interceptor.html">create-interceptor</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/create-plugin.html">create-plugin</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/create-profile.html">create-profile</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/create-script.html">create-script</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/create-service.html">create-service</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/create-taglib.html">create-taglib</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/create-unit-test.html">create-unit-test</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/dependency-report.html">dependency-report</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/docs.html">docs</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/generate-all.html">generate-all</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/generate-controller.html">generate-controller</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/generate-views.html">generate-views</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/help.html">help</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/install-templates.html">install-templates</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/list-plugins.html">list-plugins</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/list-profiles.html">list-profiles</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/package-plugin.html">package-plugin</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/package.html">package</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/plugin-info.html">plugin-info</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/profile-info.html">profile-info</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/run-app.html">run-app</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/schema-export.html">schema-export</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/shell.html">shell</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/stats.html">stats</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/stop-app.html">stop-app</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/test-app.html">test-app</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/war.html">war</a>
                            </div>
                            
                            </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Constraints</h1><div class="menu-sub">
                        
                            <div class="menu-item"><a href="../../ref/Constraints/Usage.html">Usage</a></div>
                            
                            
                            <div class="menu-item"><a href="../../ref/Constraints/attributes.html">attributes</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/bindable.html">bindable</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/blank.html">blank</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/creditCard.html">creditCard</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/email.html">email</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/inList.html">inList</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/matches.html">matches</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/max.html">max</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/maxSize.html">maxSize</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/min.html">min</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/minSize.html">minSize</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/notEqual.html">notEqual</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/nullable.html">nullable</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/range.html">range</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/scale.html">scale</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/size.html">size</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/unique.html">unique</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/url.html">url</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/validator.html">validator</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/widget.html">widget</a>
                            </div>
                            
                            </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Controllers</h1><div class="menu-sub">
                        
                            <div class="menu-item"><a href="../../ref/Controllers/Usage.html">Usage</a></div>
                            
                            
                            <div class="menu-item"><a href="../../ref/Controllers/actionName.html">actionName</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/allowedMethods.html">allowedMethods</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/bindData.html">bindData</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/chain.html">chain</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/controllerName.html">controllerName</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/defaultAction.html">defaultAction</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/errors.html">errors</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/flash.html">flash</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/forward.html">forward</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/grailsApplication.html">grailsApplication</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/hasErrors.html">hasErrors</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/namespace.html">namespace</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/params.html">params</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/redirect.html">redirect</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/render.html">render</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/request.html">request</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/respond.html">respond</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/response.html">response</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/responseFormats.html">responseFormats</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/scope.html">scope</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/servletContext.html">servletContext</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/session.html">session</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/withForm.html">withForm</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/withFormat.html">withFormat</a>
                            </div>
                            
                            </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Database Mapping</h1><div class="menu-sub">
                        
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/Usage.html">Usage</a></div>
                            
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/autoImport.html">autoImport</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/autoTimestamp.html">autoTimestamp</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/batchSize.html">batchSize</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/cache.html">cache</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/cascade.html">cascade</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/column.html">column</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/comment.html">comment</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/discriminator.html">discriminator</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/dynamicInsert.html">dynamicInsert</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/dynamicUpdate.html">dynamicUpdate</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/fetch.html">fetch</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/id.html">id</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/ignoreNotFound.html">ignoreNotFound</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/indexColumn.html">indexColumn</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/insertable.html">insertable</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/joinTable.html">joinTable</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/lazy.html">lazy</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/order.html">order</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/sort.html">sort</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/table.html">table</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/type.html">type</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/updateable.html">updateable</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/version.html">version</a>
                            </div>
                            
                            </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Domain Classes</h1><div class="menu-sub">
                        
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/Usage.html">Usage</a></div>
                            
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/addTo.html">addTo</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/attach.html">attach</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/belongsTo.html">belongsTo</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/clearErrors.html">clearErrors</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/constraints.html">constraints</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/count.html">count</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/countBy.html">countBy</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/createCriteria.html">createCriteria</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/delete.html">delete</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/discard.html">discard</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/embedded.html">embedded</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/errors.html">errors</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/executeQuery.html">executeQuery</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/executeUpdate.html">executeUpdate</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/exists.html">exists</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/fetchMode.html">fetchMode</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/find.html">find</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/findAll.html">findAll</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/findAllBy.html">findAllBy</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/findAllWhere.html">findAllWhere</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/findBy.html">findBy</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/findOrCreateBy.html">findOrCreateBy</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/findOrCreateWhere.html">findOrCreateWhere</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/findOrSaveBy.html">findOrSaveBy</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/findOrSaveWhere.html">findOrSaveWhere</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/findWhere.html">findWhere</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/first.html">first</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/get.html">get</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/getAll.html">getAll</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/getDirtyPropertyNames.html">getDirtyPropertyNames</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/getPersistentValue.html">getPersistentValue</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/hasErrors.html">hasErrors</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/hasMany.html">hasMany</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/hasOne.html">hasOne</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/ident.html">ident</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/instanceOf.html">instanceOf</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/isAttached.html">isAttached</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/isDirty.html">isDirty</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/last.html">last</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/list.html">list</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/listOrderBy.html">listOrderBy</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/load.html">load</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/lock.html">lock</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/mapWith.html">mapWith</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/mappedBy.html">mappedBy</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/mapping.html">mapping</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/merge.html">merge</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/namedQueries.html">namedQueries</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/properties.html">properties</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/read.html">read</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/refresh.html">refresh</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/removeFrom.html">removeFrom</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/save.html">save</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/transients.html">transients</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/validate.html">validate</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/where.html">where</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/whereAny.html">whereAny</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/withCriteria.html">withCriteria</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/withNewSession.html">withNewSession</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/withSession.html">withSession</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/withTransaction.html">withTransaction</a>
                            </div>
                            
                            </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Plug-ins</h1><div class="menu-sub">
                        
                            <div class="menu-item"><a href="../../ref/Plug-ins/Usage.html">Usage</a></div>
                            
                            
                            <div class="menu-item"><a href="../../ref/Plug-ins/URL%20mappings.html">URL mappings</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Plug-ins/codecs.html">codecs</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Plug-ins/controllers.html">controllers</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Plug-ins/core.html">core</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Plug-ins/dataSource.html">dataSource</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Plug-ins/domainClasses.html">domainClasses</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Plug-ins/hibernate.html">hibernate</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Plug-ins/i18n.html">i18n</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Plug-ins/logging.html">logging</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Plug-ins/scaffolding.html">scaffolding</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Plug-ins/services.html">services</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Plug-ins/servlets.html">servlets</a>
                            </div>
                            
                            </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Services</h1><div class="menu-sub">
                        
                            <div class="menu-item"><a href="../../ref/Services/Usage.html">Usage</a></div>
                            
                            
                            <div class="menu-item"><a href="../../ref/Services/scope.html">scope</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Services/transactional.html">transactional</a>
                            </div>
                            
                            </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Servlet API</h1><div class="menu-sub">
                        
                            
                            <div class="menu-item"><a href="../../ref/Servlet%20API/request.html">request</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Servlet%20API/response.html">response</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Servlet%20API/servletContext.html">servletContext</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Servlet%20API/session.html">session</a>
                            </div>
                            
                            </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Tag Libraries</h1><div class="menu-sub">
                        
                            <div class="menu-item"><a href="../../ref/Tag%20Libraries/Usage.html">Usage</a></div>
                            
                            
                            <div class="menu-item"><a href="../../ref/Tag%20Libraries/actionName.html">actionName</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tag%20Libraries/controllerName.html">controllerName</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tag%20Libraries/flash.html">flash</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tag%20Libraries/pageScope.html">pageScope</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tag%20Libraries/params.html">params</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tag%20Libraries/request.html">request</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tag%20Libraries/response.html">response</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tag%20Libraries/servletContext.html">servletContext</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tag%20Libraries/session.html">session</a>
                            </div>
                            
                            </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Tags</h1><div class="menu-sub">
                        
                            
                            <div class="menu-item"><a href="../../ref/Tags/actionSubmit.html">actionSubmit</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/actionSubmitImage.html">actionSubmitImage</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/applyLayout.html">applyLayout</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/checkBox.html">checkBox</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/collect.html">collect</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/cookie.html">cookie</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/country.html">country</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/countrySelect.html">countrySelect</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/createLink.html">createLink</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/createLinkTo.html">createLinkTo</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/currencySelect.html">currencySelect</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/datePicker.html">datePicker</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/each.html">each</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/eachError.html">eachError</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/else.html">else</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/elseif.html">elseif</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/external.html">external</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/field.html">field</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/fieldError.html">fieldError</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/fieldValue.html">fieldValue</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/findAll.html">findAll</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/form.html">form</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/formatBoolean.html">formatBoolean</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/formatDate.html">formatDate</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/formatNumber.html">formatNumber</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/grep.html">grep</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/hasErrors.html">hasErrors</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/header.html">header</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/hiddenField.html">hiddenField</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/if.html">if</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/img.html">img</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/include.html">include</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/isAvailable.html">isAvailable</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/isNotAvailable.html">isNotAvailable</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/javascript.html">javascript</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/join.html">join</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/layoutBody.html">layoutBody</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/layoutHead.html">layoutHead</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/layoutTitle.html">layoutTitle</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/link.html">link</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/localeSelect.html">localeSelect</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/message.html">message</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/meta.html">meta</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/pageProperty.html">pageProperty</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/paginate.html">paginate</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/passwordField.html">passwordField</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/radio.html">radio</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/radioGroup.html">radioGroup</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/render.html">render</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/renderErrors.html">renderErrors</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/resource.html">resource</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/select.html">select</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/set.html">set</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/sortableColumn.html">sortableColumn</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/submitButton.html">submitButton</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/textArea.html">textArea</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/textField.html">textField</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/timeZoneSelect.html">timeZoneSelect</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/unless.html">unless</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/uploadForm.html">uploadForm</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tags/while.html">while</a>
                            </div>
                            
                            </div>
                    </div>
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    Copies of this document may be made for your own use and for distribution to others, provided that you do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically.
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
